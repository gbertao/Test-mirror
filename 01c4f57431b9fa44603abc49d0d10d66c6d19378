{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "7e99cdba_71e99694",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2024-02-13T10:36:18Z",
      "side": 1,
      "message": "Sorry, I am a bit confused by this patch. Didn\u0027t we agree in the last meeting that host should inject the value of the hashtree in the DT it passes to crossvm, and pvmfw will use the value passed from bootloader to verify the DT.",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 26
      },
      "revId": "01c4f57431b9fa44603abc49d0d10d66c6d19378",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "892d0cf2_a75e5ae6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1019013
      },
      "writtenOn": "2024-02-13T10:48:29Z",
      "side": 1,
      "message": "\u003e Didn\u0027t we agree in the last meeting that host should inject the value of the hashtree in the DT it passes to crossvm, and pvmfw will use the value passed from bootloader to verify the DT.\n\nThis was my idea to test loading vendor image. At that time, I proposed that approach to test vendor image features with test image and arbitrary VM reference DT (e.g. test invalid vendor image hashkey). However, it requires to inject arbitrary VM reference DT so can only run on production device.\nSee: b/323768068.\n\n\nBut Jiyong proposed an idea to test whether real vendor image can be loaded. It\u0027s simpler and can be a CTS test. This CL is written based on the Jiyong\u0027s idea, and more complex test scenario would be handled in another issue. (but with less priority).\n\nHope this answers your question.",
      "parentUuid": "7e99cdba_71e99694",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 26
      },
      "revId": "01c4f57431b9fa44603abc49d0d10d66c6d19378",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e07b635_859140c8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2024-02-13T13:02:22Z",
      "side": 1,
      "message": "\u003e However, it requires to inject arbitrary VM reference DT so can only run on production device.\n\nYou meant non-production devices, right? I am not sure I agree, if the DT is constructed by the host, and pvmfw verifies it before booting a pVM, then approach should be safe on production devices as well. @ptosi@google.com wdyt?\n\n\u003e But Jiyong proposed an idea to test whether real vendor image can \u003ebe loaded. It\u0027s simpler and can be a CTS test. This CL is written \u003ebased on the Jiyong\u0027s idea, and more complex test scenario would \u003ebe handled in another issue. (but with less priority).\n\nWell, the caveat of this approach is that we don\u0027t really get any coverage in presubmit \u0026 postsubmit. I\u0027m not against having a test that verifies that microdroid can boot with the /vendor/etc/microdroid/microdroid-vendor.img - this sounds like a useful test. I am not sure that enabling presubmit \u0026 postsubmit coverage of the vendor modules feature has a lesser priority",
      "parentUuid": "892d0cf2_a75e5ae6",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 26
      },
      "revId": "01c4f57431b9fa44603abc49d0d10d66c6d19378",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "baefd460_e8cc7483",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1019013
      },
      "writtenOn": "2024-02-13T13:10:02Z",
      "side": 1,
      "message": "\u003e \u003e However, it requires to inject arbitrary VM reference DT so can only run on production device.\n\n\u003e You meant non-production devices, right? I am not sure I agree, if the DT is constructed by the host, and pvmfw verifies it before booting a pVM, then approach should be safe on production devices as well. \n\nI\u0027m terribly sorry here. Such test __CAN\u0027T__ run on the production device. (otherwise DT can contain malicious data.\n\nFor test purpose, we can run protected VM with arbitrary data. Custom `pvmfw` can be used for booting VM, and there\u0027s already a test for it. (e.g. DebugPolicyHostTests). It\u0027s done by passing `--protected-vm-with-firmware` to crosvm.\n\nHowever, launching custom pvmfw is only allowed in userdebug or eng build, so those test isn\u0027t a part of CTS.\n\n\n\u003e I am not sure that enabling presubmit \u0026 postsubmit coverage of the vendor modules feature has a lesser priority\n\nI\u0027m sorry but I don\u0027t understand this. Could you explain your idea about vendor module tests?",
      "parentUuid": "0e07b635_859140c8",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 26
      },
      "revId": "01c4f57431b9fa44603abc49d0d10d66c6d19378",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2c031c7e_845f5aee",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2024-02-13T13:19:06Z",
      "side": 1,
      "message": "Running microdroid with microdroid-vendor.img relies on a bunch of changes in the userspace that ideally we would want to have end-to-end coverage on. These changes are not specific to pVMs, so we can run tests on non-protected Microdroid VMs.\n\nRight now, we don\u0027t have any end-to-end coverage for userspace changes, and this patch won\u0027t address this problem (since none of the devices we use in presubmit have microdroid-vendor.img, and the  -pvkm_experimental variants are not stable enough to run in presubmit).\n\nAgain, I am not against this change. What I am saying is that running microdroid-vendor-partition tests in presubmit on non-protected VMs shouldn\u0027t have a lesser priority.\n\nI don\u0027t think that we need to do anything fancy to enable such testing. Making host responsible for constructing the DT instead of simply copying the reference DT from the ABL should be enough (in case of pVMs the pvmfw will still be responsible for validating the DT). Although I might be missing something here",
      "parentUuid": "baefd460_e8cc7483",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 26
      },
      "revId": "01c4f57431b9fa44603abc49d0d10d66c6d19378",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}