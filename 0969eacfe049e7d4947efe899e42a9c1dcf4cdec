{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e6eb35ab_b8a7ed83",
        "filename": "prebuilts/api/33.0/private/system_server.te",
        "patchSetId": 2
      },
      "lineNbr": 608,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-06-10T10:35:04Z",
      "side": 1,
      "message": "As Lint says, you shouldn\u0027t be changing the prebuilts; these changes are post-33.",
      "range": {
        "startLine": 607,
        "startChar": 0,
        "endLine": 608,
        "endChar": 26
      },
      "revId": "0969eacfe049e7d4947efe899e42a9c1dcf4cdec",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e92630ec_11eea337",
        "filename": "prebuilts/api/33.0/private/system_server.te",
        "patchSetId": 2
      },
      "lineNbr": 608,
      "author": {
        "id": 1872107
      },
      "writtenOn": "2022-06-14T15:50:55Z",
      "side": 1,
      "message": "removed",
      "parentUuid": "e6eb35ab_b8a7ed83",
      "range": {
        "startLine": 607,
        "startChar": 0,
        "endLine": 608,
        "endChar": 26
      },
      "revId": "0969eacfe049e7d4947efe899e42a9c1dcf4cdec",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "237189b5_86e42512",
        "filename": "private/system_server.te",
        "patchSetId": 2
      },
      "lineNbr": 614,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-06-10T10:35:04Z",
      "side": 1,
      "message": "Can we consolidate these rules a bit into just one pair, and update the comments? The new rules entirely subsume the old ones.\n\nI don\u0027t think you need all of create_dir_perms / create_file_perms. In particular I don\u0027t think you need to delete files. Would ra_dir_perms suffice (read + append)?\n\nWhat denials do you actually see without these new rules?",
      "range": {
        "startLine": 604,
        "startChar": 0,
        "endLine": 614,
        "endChar": 0
      },
      "revId": "0969eacfe049e7d4947efe899e42a9c1dcf4cdec",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "542704c3_4fefb4fb",
        "filename": "private/system_server.te",
        "patchSetId": 2
      },
      "lineNbr": 614,
      "author": {
        "id": 1872107
      },
      "writtenOn": "2022-06-14T15:50:55Z",
      "side": 1,
      "message": "We want to create and delete a temporary file. I am getting this error when trying to create the file:\n06-14 13:51:20.435   641   641 W NativeTombstone: type\u003d1400 audit(0.0:180): avc: denied { write } for name\u003d\"tombstones\" dev\u003d\"dm-51\" ino\u003d22 scontext\u003du:r:system_server:s0 tcontext\u003du:object_r:tombstone_data_file:s0 tclass\u003ddir permissive\u003d0\n\nomitting the create_file_perms rule results in:\n06-14 15:08:19.716   632   632 W NativeTombstone: type\u003d1400 audit(0.0:172): avc: denied { create } for name\u003d\"tombstone_01.pb8394094009819507959.tmp\" scontext\u003du:r:system_server:s0 tcontext\u003du:object_r:tombstone_data_file:s0 tclass\u003dfile permissive\u003d0\n\nomitting the create_dir_perms rule results in the original error:\nNativeTombstone: type\u003d1400 audit(0.0:172): avc: denied { write } for name\u003d\"tombstones\" dev\u003d\"dm-51\" ino\u003d26 scontext\u003du:r:system_server:s0 tcontext\u003du:object_r:tombstone_data_file:s0 tclass\u003ddir permissive\u003d0",
      "parentUuid": "237189b5_86e42512",
      "range": {
        "startLine": 604,
        "startChar": 0,
        "endLine": 614,
        "endChar": 0
      },
      "revId": "0969eacfe049e7d4947efe899e42a9c1dcf4cdec",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9643efa7_88dc6786",
        "filename": "private/system_server.te",
        "patchSetId": 2
      },
      "lineNbr": 614,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-06-15T10:22:53Z",
      "side": 1,
      "message": "\u003e We want to create and delete a temporary file.\n\nThat\u0027s ok, I\u0027d just like to make sure you grant the permissions you need for that and not a lot more. Does this work for you?\n\nallow system_server tombstone_data_file:dir w_dir_perms;\nallow system_server tombstone_data_file:file create_file_perms;\n\nI think w_dir_perms gives you everything you need.\n\nAnd as I said, with that the preceding rules are no longer needed, and the comments just need consolidating.",
      "parentUuid": "542704c3_4fefb4fb",
      "range": {
        "startLine": 604,
        "startChar": 0,
        "endLine": 614,
        "endChar": 0
      },
      "revId": "0969eacfe049e7d4947efe899e42a9c1dcf4cdec",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d68d96b6_b7470396",
        "filename": "private/system_server.te",
        "patchSetId": 2
      },
      "lineNbr": 614,
      "author": {
        "id": 1872107
      },
      "writtenOn": "2022-07-01T10:37:49Z",
      "side": 1,
      "message": "We still need r_dir_perms aswell for the already existing code to keep functioning. I consolidated the rules to have rw_dir_perms and create_file_perms, and removed the rest. This seems to pass the tests we have, however, I am still seeing some avc errors that I am unsure what they are caused by:\n\n06-29 15:04:52.539   553   553 W tombstone_trans: type\u003d1400 audit(0.0:172): avc: denied { dac_read_search } for capability\u003d2 scontext\u003du:r:tombstone_transmit:s0 tcontext\u003du:r:tombstone_transmit:s0 tclass\u003dcapability permissive\u003d0\n06-29 15:04:52.539   553   553 W tombstone_trans: type\u003d1400 audit(0.0:172): avc: denied { dac_override } for capability\u003d1 scontext\u003du:r:tombstone_transmit:s0 tcontext\u003du:r:tombstone_transmit:s0 tclass\u003dcapability permissive\u003d0",
      "parentUuid": "9643efa7_88dc6786",
      "range": {
        "startLine": 604,
        "startChar": 0,
        "endLine": 614,
        "endChar": 0
      },
      "revId": "0969eacfe049e7d4947efe899e42a9c1dcf4cdec",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2658f34d_839f530b",
        "filename": "private/system_server.te",
        "patchSetId": 2
      },
      "lineNbr": 614,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-07-01T10:52:23Z",
      "side": 1,
      "message": "rw_dir_perms is fine.\n\nThat means tombstone_transmit is trying to access files that it doesn\u0027t have Unix (rather than selinux) permissions for, and is getting denied because it isn\u0027t allowed to use the capabilities to override that.\n\nIf everything works anyway you could just dontaudit those (ie suppress the denials), or figure out what exactly it is trying to do and make it stop.",
      "parentUuid": "d68d96b6_b7470396",
      "range": {
        "startLine": 604,
        "startChar": 0,
        "endLine": 614,
        "endChar": 0
      },
      "revId": "0969eacfe049e7d4947efe899e42a9c1dcf4cdec",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "db171501_a82e2cb9",
        "filename": "private/system_server.te",
        "patchSetId": 2
      },
      "lineNbr": 614,
      "author": {
        "id": 1872107
      },
      "writtenOn": "2022-08-10T15:27:27Z",
      "side": 1,
      "message": "I was not giving the temporary file I created appropriate permissions. After fixing that there are no more avc errors.",
      "parentUuid": "2658f34d_839f530b",
      "range": {
        "startLine": 604,
        "startChar": 0,
        "endLine": 614,
        "endChar": 0
      },
      "revId": "0969eacfe049e7d4947efe899e42a9c1dcf4cdec",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}