{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "bfb339ab_29c0cb1c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1124693
      },
      "writtenOn": "2020-10-13T00:00:39Z",
      "side": 1,
      "message": "CC\u0027ing Steven, since this is tangentially Treble related.",
      "revId": "94fe93a92abe11a08ca77287e62dc39458338ba0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5800815e_41bf82ec",
        "filename": "Android.mk",
        "patchSetId": 5
      },
      "lineNbr": 60,
      "author": {
        "id": 1124693
      },
      "writtenOn": "2020-10-13T00:00:39Z",
      "side": 1,
      "message": "Since these are intended to be used downstream, could you add a comment describing how to use them?",
      "range": {
        "startLine": 59,
        "startChar": 0,
        "endLine": 60,
        "endChar": 78
      },
      "revId": "94fe93a92abe11a08ca77287e62dc39458338ba0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "deaeccd4_56f425ef",
        "filename": "Android.mk",
        "patchSetId": 5
      },
      "lineNbr": 60,
      "author": {
        "id": 1611820
      },
      "writtenOn": "2020-10-13T00:38:11Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "5800815e_41bf82ec",
      "range": {
        "startLine": 59,
        "startChar": 0,
        "endLine": 60,
        "endChar": 78
      },
      "revId": "94fe93a92abe11a08ca77287e62dc39458338ba0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5398e977_e7e7463b",
        "filename": "Android.mk",
        "patchSetId": 5
      },
      "lineNbr": 1718,
      "author": {
        "id": 1124693
      },
      "writtenOn": "2020-10-13T00:00:39Z",
      "side": 1,
      "message": "I don\u0027t think we want to enforce a directory structure within external locations. Diffing SEPOLICY_FREEZE_TEST_EXTRA_PREBUILT_DIRS with SEPOLICY_FREEZE_TEST_EXTRA_DIRS should be sufficient.\n\nAlso, we don\u0027t want a situation where FREEZE_TEST_EXTRA_PREBUILT_DIRS was accidentally set in master, and SDK finalization is blocked on having to update extra prebuilt. I think we should make it so that the build variables can only be set iff sepolicy_freeze_test is enable.",
      "range": {
        "startLine": 1718,
        "startChar": 0,
        "endLine": 1718,
        "endChar": 91
      },
      "revId": "94fe93a92abe11a08ca77287e62dc39458338ba0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "159b28a1_47cc00de",
        "filename": "Android.mk",
        "patchSetId": 5
      },
      "lineNbr": 1718,
      "author": {
        "id": 1611820
      },
      "writtenOn": "2020-10-13T00:38:11Z",
      "side": 1,
      "message": "For the first part, I tested diffing SEPOLICY_FREEZE_TEST_EXTRA_PREBUILT_DIRS and SEPOLICY_FREEZE_TEST_EXTRA_DIRS this afternoon; it breaks if SEPOLICY_FREEZE_TEST_EXTRA_DIRS points to foo/bar/sepolicy and SEPOLICY_FREEZE_TEST_EXTRA_PREBUILT_DIRS points to foo/bar/sepolicy/prebuilts. So I\u0027d keep enforcing the directory structure.\n\nI may need some clarification on \"setting build variables iff sepolicy_freeze_test is enabled\". Is there any similar code I can refer to?",
      "parentUuid": "5398e977_e7e7463b",
      "range": {
        "startLine": 1718,
        "startChar": 0,
        "endLine": 1718,
        "endChar": 91
      },
      "revId": "94fe93a92abe11a08ca77287e62dc39458338ba0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3ff97d8b_a56dbe69",
        "filename": "Android.mk",
        "patchSetId": 5
      },
      "lineNbr": 1718,
      "author": {
        "id": 1124693
      },
      "writtenOn": "2020-10-13T01:01:01Z",
      "side": 1,
      "message": "\u003e For the first part, I tested diffing SEPOLICY_FREEZE_TEST_EXTRA_PREBUILT_DIRS and SEPOLICY_FREEZE_TEST_EXTRA_DIRS this afternoon; it breaks if SEPOLICY_FREEZE_TEST_EXTRA_DIRS points to foo/bar/sepolicy and SEPOLICY_FREEZE_TEST_EXTRA_PREBUILT_DIRS points to foo/bar/sepolicy/prebuilts. So I\u0027d keep enforcing the directory structure.\n\nThis only means that one can\u0027t be a subdirectory of the other and vice versa, right?\nSo if you have:\nfoo/bar/sepolicy\nfoo/bar/sepolicy/public\nfoo/bar/sepolicy/private\nfoo/bar/sepolicy/prebuilts\nfoo/bar/sepolicy/prebuilts/public\nfoo/bar/sepolicy/prebuilts/private\n\nyou have to set the variables as:\n\n SEPOLICY_FREEZE_TEST_EXTRA_DIRS :\u003d \\\n    foo/bar/sepolicy/public \\\n    foo/bar/sepolicy/private\n\t\n SEPOLICY_FREEZE_TEST_EXTRA_PREBUILT_DIRS :\u003d \\\n    foo/bar/sepolicy/prebuilts/public \\\n    foo/bar/sepolicy/prebuilts/private\n\n\u003e I may need some clarification on \"setting build variables iff sepolicy_freeze_test is enabled\". Is there any similar code I can refer to?\n\nLine#321 is what make the build depend on sepolicy_freeze_test. Make it so that the build fails if sepolicy_freeze_test is not depended on AND one of the new build variables is set.",
      "parentUuid": "159b28a1_47cc00de",
      "range": {
        "startLine": 1718,
        "startChar": 0,
        "endLine": 1718,
        "endChar": 91
      },
      "revId": "94fe93a92abe11a08ca77287e62dc39458338ba0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "75e69aff_6b99d475",
        "filename": "Android.mk",
        "patchSetId": 5
      },
      "lineNbr": 1718,
      "author": {
        "id": 1611820
      },
      "writtenOn": "2020-10-13T01:18:27Z",
      "side": 1,
      "message": "That could work but i see developers would usually assume \"sepolicy\" is the dir they want to add to the build var; rather than \"sepolicy/public sepolicy/private\". And system/sepolicy/prebuilt is the prebuilt for the core policy. I\u0027m trying to be consistent with it.\n\nPerhaps modeling the behavior after PRODUCT_*_POLICY is a better idea? But in that case we would need to define 4 build vars `FREEZE_TEST_EXTRA_PUBLIC_DIRS`, `FREEZE_TEST_EXTRA_PUBLIC_PREBUILT_DIRS`, `FREEZE_TEST_EXTRA_PRIVATE_DIRS`, `FREEZE_TEST_EXTRA_PRIVATE_PREBUILT_DIRS`. Wdyt?\n\n\nRe: Line #321 I still don\u0027t get it. If `sepolicy_freeze_test` is not included in `LOCAL_REQUIRED_MODULES`, then no one uses SEPOLICY_FREEZE_TEST_* build vars. Why does it bother failing the build?",
      "parentUuid": "3ff97d8b_a56dbe69",
      "range": {
        "startLine": 1718,
        "startChar": 0,
        "endLine": 1718,
        "endChar": 91
      },
      "revId": "94fe93a92abe11a08ca77287e62dc39458338ba0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a41958de_8b38d775",
        "filename": "Android.mk",
        "patchSetId": 5
      },
      "lineNbr": 1718,
      "author": {
        "id": 1124693
      },
      "writtenOn": "2020-10-13T02:30:44Z",
      "side": 1,
      "message": "\u003e That could work but i see developers would usually assume \"sepolicy\" is the dir they want to add to the build var; rather than \"sepolicy/public sepolicy/private\". And system/sepolicy/prebuilt is the prebuilt for the core policy. I\u0027m trying to be consistent with it.\n\nBuild vars usually point to location of *.te files, which isn\u0027t necessarily a directory named \"sepolicy\", e.g. https://android.googlesource.com/device/google/crosshatch-sepolicy/+/refs/heads/master/crosshatch-sepolicy.mk#5\n\n\u003e Perhaps modeling the behavior after PRODUCT_*_POLICY is a better idea? But in that case we would need to define 4 build vars `FREEZE_TEST_EXTRA_PUBLIC_DIRS`, `FREEZE_TEST_EXTRA_PUBLIC_PREBUILT_DIRS`, `FREEZE_TEST_EXTRA_PRIVATE_DIRS`, `FREEZE_TEST_EXTRA_PRIVATE_PREBUILT_DIRS`. Wdyt?\n\nNot every sepolicy location is split into public and private though, e.g. vendor sepolicy. I think giving two list of directories that need to be diffed is going to be most flexible.\n\n\u003e Re: Line #321 I still don\u0027t get it. If `sepolicy_freeze_test` is not included in `LOCAL_REQUIRED_MODULES`, then no one uses SEPOLICY_FREEZE_TEST_* build vars. Why does it bother failing the build?\n\nOnce every release during SDK finalization sepolicy_freeze_test is flipped to enforced. I\u0027d like to avoid any surprises during that process.",
      "parentUuid": "75e69aff_6b99d475",
      "range": {
        "startLine": 1718,
        "startChar": 0,
        "endLine": 1718,
        "endChar": 91
      },
      "revId": "94fe93a92abe11a08ca77287e62dc39458338ba0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d9af3234_6900ef54",
        "filename": "Android.mk",
        "patchSetId": 5
      },
      "lineNbr": 1718,
      "author": {
        "id": 1611820
      },
      "writtenOn": "2020-10-13T04:41:46Z",
      "side": 1,
      "message": "I see. That makes sense for FREEZE_TEST_EXTRA_DIRS. But I still have a concern for FREEZE_TEST_EXTRA_PREBUILT_DIRS. The \"/api/$(PLATFORM_SEPOLICY_VERSION)\" suffix needs to be added after each dir in FREEZE_TEST_EXTRA_PREBUILT_DIRS. As such, \"sepolicy/prebuilt/public\" would become \"sepolicy/prebuilt/public/api/30.0\", rather than \"sepolicy/prebuilt/api/30.0/public\" as in `system/sepolicy`.\n\nI have defined a `HAS_EXTRA_FREEZE_TEST` flag that only runs the extra freeze test when `sepolicy_freeze_test` is included in `LOCAL_REQUIRED_MODULES` and `FREEZE_TEST_EXTRA_*` are not empty. I can make it a separate test if you prefer.",
      "parentUuid": "a41958de_8b38d775",
      "range": {
        "startLine": 1718,
        "startChar": 0,
        "endLine": 1718,
        "endChar": 91
      },
      "revId": "94fe93a92abe11a08ca77287e62dc39458338ba0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}