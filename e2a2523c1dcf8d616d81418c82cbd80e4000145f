{
  "comments": [
    {
      "key": {
        "uuid": "b96b86ea_515bd07f",
        "filename": "public/modprobe.te",
        "patchSetId": 3
      },
      "lineNbr": 3,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2017-03-08T04:39:47Z",
      "side": 1,
      "message": "let\u0027s cut this down to just /proc/modules\n\nPlease\n1. provide a specific label for /proc/modules (apply in genfscon). something like proc_modules\n2. Then only grant read access to modprobe.",
      "range": {
        "startLine": 3,
        "startChar": 0,
        "endLine": 3,
        "endChar": 38
      },
      "revId": "e2a2523c1dcf8d616d81418c82cbd80e4000145f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b361504a_f6d14f23",
        "filename": "public/modprobe.te",
        "patchSetId": 3
      },
      "lineNbr": 3,
      "author": {
        "id": 1143592
      },
      "writtenOn": "2017-03-08T05:06:15Z",
      "side": 1,
      "message": "What about for /proc/cmdline ?\n\nI tried it, but I have following denials. Note that even with those denials inserting modules has been succeeded.\n\n[   17.091823] c2      1 audit: type\u003d1400 audit(6221547.076:4): avc:  denied  { setattr } for  pid\u003d1 comm\u003d\"init\" name\u003d\"system\" dev\u003d\"rootfs\" ino\u003d12891 scontext\u003du:r:init:s0 tcontext\u003du:object_r:rootfs:s0 tclass\u003dlnk_file permissive\u003d0\n[   17.111385] c2      1 init: starting service \u0027exec 1 (/sbin/modprobe)\u0027...\n[   17.118103] c2      1 init: SVC_EXEC pid 435 (uid 0 gid 0+0 context u:r:modprobe:s0) started; waiting...\n[   17.120842] c0    435 audit: type\u003d1400 audit(6221547.106:5): avc:  denied  { search } for  pid\u003d435 comm\u003d\"modprobe\" name\u003d\"/\" dev\u003d\"tmpfs\" ino\u003d14434 scontext\u003du:r:modprobe:s0 tcontext\u003du:object_r:tmpfs:s0 tclass\u003ddir permissive\u003d0   \n[   17.121006] c0    435 audit: type\u003d1400 audit(6221547.106:6): avc:  denied  { read } for  pid\u003d435 comm\u003d\"modprobe\" name\u003d\"cmdline\" dev\u003d\"proc\" ino\u003d4026532350 scontext\u003du:r:modprobe:s0 tcontext\u003du:object_r:proc:s0 tclass\u003dfile permissive\u003d0\n[   17.129950] c0    435 NILFS version 2 loaded\n[   17.171728] c2      1 init: Command \u0027exec u:r:modprobe:s0 -- /sbin/modprobe -a nilfs2 ftl\u0027 action\u003dinit (/init.rc:32) returned 0 took 60.3427ms.\n[   17.184661] c2      1 init: Service \u0027exec 1 (/sbin/modprobe)\u0027 (pid 435) exited with status 0\n[   17.192905] c2      1 init: SVC_EXEC pid 435 finished...\n[   17.198199] c2      1 init: Wait for exec took 0.0868338 seconds\n\n#\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d modprobe \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\nallow modprobe proc:file read;\nallow modprobe tmpfs:dir search;",
      "parentUuid": "b96b86ea_515bd07f",
      "range": {
        "startLine": 3,
        "startChar": 0,
        "endLine": 3,
        "endChar": 38
      },
      "revId": "e2a2523c1dcf8d616d81418c82cbd80e4000145f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5f4e9872_86d35d40",
        "filename": "public/modprobe.te",
        "patchSetId": 3
      },
      "lineNbr": 3,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2017-03-08T05:14:54Z",
      "side": 1,
      "message": "Please investigate why modprobe needs cmdline access?",
      "parentUuid": "b361504a_f6d14f23",
      "range": {
        "startLine": 3,
        "startChar": 0,
        "endLine": 3,
        "endChar": 38
      },
      "revId": "e2a2523c1dcf8d616d81418c82cbd80e4000145f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "11a232f7_1068366c",
        "filename": "public/modprobe.te",
        "patchSetId": 3
      },
      "lineNbr": 3,
      "author": {
        "id": 1143592
      },
      "writtenOn": "2017-03-08T06:22:36Z",
      "side": 1,
      "message": "modprobe needs to parse kernel cmdline to get module parameters. \n\nFYI, it has not been decided whether to use kernel cmdline to pass module parameters. However, I think we\u0027d better to allow it for now for better flexibility.",
      "parentUuid": "5f4e9872_86d35d40",
      "range": {
        "startLine": 3,
        "startChar": 0,
        "endLine": 3,
        "endChar": 38
      },
      "revId": "e2a2523c1dcf8d616d81418c82cbd80e4000145f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "823b7d4b_5dfa3105",
        "filename": "public/modprobe.te",
        "patchSetId": 3
      },
      "lineNbr": 3,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2017-03-08T06:27:16Z",
      "side": 1,
      "message": "Ok, please upload a change that gives cmdline and modules different contexts. This change will also benefit https://android-review.googlesource.com/#/c/348680/",
      "parentUuid": "11a232f7_1068366c",
      "range": {
        "startLine": 3,
        "startChar": 0,
        "endLine": 3,
        "endChar": 38
      },
      "revId": "e2a2523c1dcf8d616d81418c82cbd80e4000145f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c4571084_2cc76f7e",
        "filename": "public/modprobe.te",
        "patchSetId": 3
      },
      "lineNbr": 3,
      "author": {
        "id": 1143592
      },
      "writtenOn": "2017-03-08T06:44:01Z",
      "side": 1,
      "message": "OK. I found that I need to give read permissions to the kernel also as can be seen from below denials.\n\nDenials:\n[   14.670605] c3      1 audit: type\u003d1400 audit(6227037.640:3): avc:  denied  { read } for  pid\u003d1 comm\u003d\"init\" name\u003d\"cmdline\" dev\u003d\"proc\" ino\u003d4026532350 scontext\u003du:r:kernel:s0 tcontext\u003du:object_r:proc_cmdline:s0 tclass\u003dfile permissive\u003d1\n[   14.690828] c3      1 audit: type\u003d1400 audit(6227037.660:4): avc:  denied  { open } for  pid\u003d1 comm\u003d\"init\" path\u003d\"/proc/cmdline\" dev\u003d\"proc\" ino\u003d4026532350 scontext\u003du:r:kernel:s0 tcontext\u003du:object_r:proc_cmdline:s0 tclass\u003dfile permissive\u003d1\n[   14.712108] c3      1 audit: type\u003d1404 audit(6227037.680:5): enforcing\u003d1 old_enforcing\u003d0 auid\u003d4294967295 ses\u003d4294967295\n[   14.724234] c2      1 selinux: SELinux: Loaded file_contexts",
      "parentUuid": "823b7d4b_5dfa3105",
      "range": {
        "startLine": 3,
        "startChar": 0,
        "endLine": 3,
        "endChar": 38
      },
      "revId": "e2a2523c1dcf8d616d81418c82cbd80e4000145f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}