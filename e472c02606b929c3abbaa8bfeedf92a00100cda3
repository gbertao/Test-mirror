{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "0f9687d8_eca249e4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1131148
      },
      "writtenOn": "2021-03-18T01:34:55Z",
      "side": 1,
      "message": "Hey Jeff, I was able to take your suggestions and entirely do away with the service in favor of just a property the shell can write to. One question: is it okay to drop caches when the property is set and to avoid unsetting it afterwards? Would it be better to unset sys.drop_caches after dropping the caches, or is the current pattern okay?",
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "af07ab36_ea634e9f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2021-03-18T11:04:24Z",
      "side": 1,
      "message": "Yeah, this is _much_ cleaner. Thanks!\n\nWhy not have init unset it after it writes to the file?",
      "parentUuid": "0f9687d8_eca249e4",
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "260d664e_6a1012c4",
        "filename": "private/property_contexts",
        "patchSetId": 9
      },
      "lineNbr": 264,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-03-18T04:21:19Z",
      "side": 1,
      "message": "please don\u0027t use sys. https://source.android.com/devices/architecture/configuration/add-system-properties#property-name has more info about naming.",
      "range": {
        "startLine": 264,
        "startChar": 0,
        "endLine": 264,
        "endChar": 4
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "39ec941e_bcf0e0aa",
        "filename": "private/property_contexts",
        "patchSetId": 9
      },
      "lineNbr": 264,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-03-18T04:21:19Z",
      "side": 1,
      "message": "where is this defined?",
      "range": {
        "startLine": 264,
        "startChar": 35,
        "endLine": 264,
        "endChar": 51
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b7cfb3c4_5144aeee",
        "filename": "private/property_contexts",
        "patchSetId": 9
      },
      "lineNbr": 264,
      "author": {
        "id": 1291338
      },
      "writtenOn": "2021-03-18T11:01:22Z",
      "side": 1,
      "message": "add \u0027exact bool\u0027",
      "range": {
        "startLine": 264,
        "startChar": 0,
        "endLine": 264,
        "endChar": 54
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d57c5375_193c731b",
        "filename": "private/property_contexts",
        "patchSetId": 9
      },
      "lineNbr": 264,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2021-03-18T11:01:44Z",
      "side": 1,
      "message": "Yeah, the build failure is telling you that the type is not defined. You need to declare it in private/property.te.",
      "parentUuid": "39ec941e_bcf0e0aa",
      "range": {
        "startLine": 264,
        "startChar": 35,
        "endLine": 264,
        "endChar": 51
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8a437b81_159bff22",
        "filename": "private/property_contexts",
        "patchSetId": 9
      },
      "lineNbr": 264,
      "author": {
        "id": 1131148
      },
      "writtenOn": "2021-03-18T22:29:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "260d664e_6a1012c4",
      "range": {
        "startLine": 264,
        "startChar": 0,
        "endLine": 264,
        "endChar": 4
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "68551c33_7e0ac97f",
        "filename": "private/property_contexts",
        "patchSetId": 9
      },
      "lineNbr": 264,
      "author": {
        "id": 1131148
      },
      "writtenOn": "2021-03-18T22:29:26Z",
      "side": 1,
      "message": "/proc/sys/vm/drop_caches can accept 1, 2, and 3. For now, we\u0027re using 3, so I made the property reflect that value. I used `exact uint` here instead of `exact bool`; is that correct? Can it accept only 1, 2, and 3, like `exact enum` supports?",
      "parentUuid": "b7cfb3c4_5144aeee",
      "range": {
        "startLine": 264,
        "startChar": 0,
        "endLine": 264,
        "endChar": 54
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ad1dc542_8ffcedbd",
        "filename": "private/property_contexts",
        "patchSetId": 9
      },
      "lineNbr": 264,
      "author": {
        "id": 1131148
      },
      "writtenOn": "2021-03-18T22:29:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d57c5375_193c731b",
      "range": {
        "startLine": 264,
        "startChar": 35,
        "endLine": 264,
        "endChar": 51
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "26b8508a_b2f94cf6",
        "filename": "private/property_contexts",
        "patchSetId": 9
      },
      "lineNbr": 264,
      "author": {
        "id": 1291338
      },
      "writtenOn": "2021-03-19T02:54:12Z",
      "side": 1,
      "message": "uint or int will be correct.\n\nIf you explicitly want 1, 2 and 3, then you can use `exact enum 1 2 3`.",
      "parentUuid": "68551c33_7e0ac97f",
      "range": {
        "startLine": 264,
        "startChar": 0,
        "endLine": 264,
        "endChar": 54
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4df68b8c_11fba9ec",
        "filename": "private/shell.te",
        "patchSetId": 9
      },
      "lineNbr": 121,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2021-03-18T11:01:44Z",
      "side": 1,
      "message": "please also add a neverallow rule on both set/get of this property. e.g.\n\nneverallow { domain -shell -init } drop_caches_prop:property_service set;\nneverallow { domain -shell -init } drop_caches_prop:file read;",
      "range": {
        "startLine": 121,
        "startChar": 16,
        "endLine": 121,
        "endChar": 32
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b6e15d68_da46afeb",
        "filename": "private/shell.te",
        "patchSetId": 9
      },
      "lineNbr": 121,
      "author": {
        "id": 1131148
      },
      "writtenOn": "2021-03-18T22:29:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4df68b8c_11fba9ec",
      "range": {
        "startLine": 121,
        "startChar": 16,
        "endLine": 121,
        "endChar": 32
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "02fba57e_ef4198e0",
        "filename": "private/shell.te",
        "patchSetId": 9
      },
      "lineNbr": 121,
      "author": {
        "id": 1131148
      },
      "writtenOn": "2021-03-18T22:52:46Z",
      "side": 1,
      "message": "I also needed to add -dumpstate to the 2nd line to get this compiling. Otherwise, I was getting this error message:\n\n```\nFAILED: out/target/product/coral/obj/FAKE/sepolicy_neverallows_intermediates/sepolicy_neverallows\n/bin/bash -c \"(ASAN_OPTIONS\u003ddetect_leaks\u003d0 out/host/linux-x86/bin/checkpolicy -M -c             30 -o out/target/product/coral/obj/FAKE/sepolicy_neverallows_intermediates/sepolicy_neverallows.tmp out/target/product/coral/obj/FAKE/sepolicy_neverallows_intermediates/policy.conf ) \u0026\u0026 (out/host/linux-x86/bin/sepolicy-analyze out/target/product/coral/obj/FAKE/sepolicy_neverallows_intermediates/sepolicy_neverallows.tmp neverallow -w -f out/target/product/coral/obj/FAKE/sepolicy_neverallows_intermediates/policy_2.conf ||    ( echo \\\"\\\" 1\u003e\u00262;         echo \\\"sepolicy-analyze failed. This is most likely due to the use\\\" 1\u003e\u00262;         echo \\\"of an expanded attribute in a neverallow assertion. Please fix\\\" 1\u003e\u00262;      echo \\\"the policy.\\\" 1\u003e\u00262;      exit 1 ) ) \u0026\u0026 (touch out/target/product/coral/obj/FAKE/sepolicy_neverallows_intermediates/sepolicy_neverallows.tmp ) \u0026\u0026 (mv out/target/product/coral/obj/FAKE/sepolicy_neverallows_intermediates/sepolicy_neverallows.tmp out/target/product/coral/obj/FAKE/sepolicy_neverallows_intermediates/sepolicy_neverallows )\"\nlibsepol.report_failure: neverallow on line 196 of system/sepolicy/private/shell.te (or line 51851 of policy.conf) violated by allow dumpstate perf_drop_caches_prop:file { read };\nlibsepol.check_assertions: 1 neverallow failures occurred\nError while expanding policy\n[  7% 11/150] build out/target/product/coral/obj/ETC/sepolicy.recovery_intermediates/sepolicy\nFAILED: out/target/product/coral/obj/ETC/sepolicy.recovery_intermediates/sepolicy\n/bin/bash -c \"(ASAN_OPTIONS\u003ddetect_leaks\u003d0 out/host/linux-x86/bin/checkpolicy -M -c             30 -o out/target/product/coral/obj/ETC/sepolicy.recovery_intermediates/sepolicy.tmp out/target/product/coral/obj/ETC/sepolicy.recovery_intermediates/sepolicy.recovery.conf ) \u0026\u0026 (out/host/linux-x86/bin/sepolicy-analyze out/target/product/coral/obj/ETC/sepolicy.recovery_intermediates/sepolicy.tmp permissive \u003e out/target/product/coral/obj/ETC/sepolicy.recovery_intermediates/sepolicy.permissivedomains ) \u0026\u0026 (if [ \\\"userdebug\\\" \u003d \\\"user\\\" -a -s out/target/product/coral/obj/ETC/sepolicy.recovery_intermediates/sepolicy.permissivedomains ]; then              echo \\\"\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\\\" 1\u003e\u00262;               echo \\\"ERROR: permissive domains not allowed in user builds\\\" 1\u003e\u00262;                echo \\\"List of invalid domains:\\\" 1\u003e\u00262;                 cat out/target/product/coral/obj/ETC/sepolicy.recovery_intermediates/sepolicy.permissivedomains 1\u003e\u00262;              exit 1;                 fi ) \u0026\u0026 (mv out/target/product/coral/obj/ETC/sepolicy.recovery_intermediates/sepolicy.tmp out/target/product/coral/obj/ETC/sepolicy.recovery_intermediates/sepolicy )\"\nlibsepol.report_failure: neverallow on line 196 of system/sepolicy/private/shell.te (or line 54622 of policy.conf) violated by allow dumpstate perf_drop_caches_prop:file { read };\nlibsepol.check_assertions: 1 neverallow failures occurred\n```",
      "parentUuid": "b6e15d68_da46afeb",
      "range": {
        "startLine": 121,
        "startChar": 16,
        "endLine": 121,
        "endChar": 32
      },
      "revId": "e472c02606b929c3abbaa8bfeedf92a00100cda3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}