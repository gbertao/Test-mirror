{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "426ce128_a97527d5",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 59,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-08-04T21:37:15Z",
      "side": 1,
      "message": "Alan, PTAL.  This brings back the previous rule with additional app domains.  We probably don\u0027t expect other app domains to use this new API...?",
      "range": {
        "startLine": 59,
        "startChar": 15,
        "endLine": 59,
        "endChar": 53
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e4ed9def_98e3fa11",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 59,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-08-07T09:15:15Z",
      "side": 1,
      "message": "Well, it seems a slightly unusual list, but I guess it\u0027s sufficient. Isolated and ephemeral apps probably shouldn\u0027t be on it, and system and platform apps probably don\u0027t need it.",
      "parentUuid": "426ce128_a97527d5",
      "range": {
        "startLine": 59,
        "startChar": 15,
        "endLine": 59,
        "endChar": 53
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e0f5ab5_21b64ecd",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 59,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-08-07T09:15:15Z",
      "side": 1,
      "message": "untrusted_app_all, or this is too narrow.",
      "range": {
        "startLine": 59,
        "startChar": 17,
        "endLine": 59,
        "endChar": 30
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac008fe0_8b99b98e",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 59,
      "author": {
        "id": 1166043
      },
      "writtenOn": "2023-08-07T16:34:31Z",
      "side": 1,
      "message": "system apps are just preinstalled apps. e.g. Samsung would preinstall FB on their system partition",
      "parentUuid": "5e0f5ab5_21b64ecd",
      "range": {
        "startLine": 59,
        "startChar": 17,
        "endLine": 59,
        "endChar": 30
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e417108_86a1eed8",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 59,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-08-07T16:45:56Z",
      "side": 1,
      "message": "That would still be untrusted_app for SELinux, or priv_app if privileged.\n(There is a system_app label, but it applies to apps that run with the system server UID, which is just gratuitously misleading. And there\u0027s also platform_app, which applies to apps that are platform-signed. Plus a bunch of more specific labels.)",
      "parentUuid": "ac008fe0_8b99b98e",
      "range": {
        "startLine": 59,
        "startChar": 17,
        "endLine": 59,
        "endChar": 30
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fef62f1a_47e18f32",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 59,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-08-07T18:23:53Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5e417108_86a1eed8",
      "range": {
        "startLine": 59,
        "startChar": 17,
        "endLine": 59,
        "endChar": 30
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6bf5946_a6ebd348",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1166043
      },
      "writtenOn": "2023-08-07T16:34:31Z",
      "side": 1,
      "message": "what about MEASURE?",
      "range": {
        "startLine": 60,
        "startChar": 50,
        "endLine": 60,
        "endChar": 70
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "876021f0_5fcfafee",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-08-07T18:23:53Z",
      "side": 1,
      "message": "The measure ioctl is simple and not concerning to security, so we can simply let the app communicate with the kernel directly.",
      "parentUuid": "d6bf5946_a6ebd348",
      "range": {
        "startLine": 60,
        "startChar": 50,
        "endLine": 60,
        "endChar": 70
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "20b1a55a_e0f5295f",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1166043
      },
      "writtenOn": "2023-08-07T18:26:52Z",
      "side": 1,
      "message": "hmm, so all of this is just because we are not sure that someone would not crash the kernel using FS_IOC_ENABLE_VERITY?\nare we aware of any such vulnerability?\nalso, given this is shipped in V+, can we instead require/check kernel version and return error in case the kernel is vulnerable?",
      "parentUuid": "876021f0_5fcfafee",
      "range": {
        "startLine": 60,
        "startChar": 50,
        "endLine": 60,
        "endChar": 70
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fa63475f_b2489c91",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-08-07T18:36:57Z",
      "side": 1,
      "message": "Eric has fixed a bunch.  You can find a list in this discussion on a Linux mailing list: https://lore.kernel.org/fsverity/CAMw\u003dZnQitwaR+oCKzxPxAZ1Ehs-86bfHbo0uPTeKe5a+5geV6A@mail.gmail.com/T/#mc17b712ca959fe17efb2bc0ddf8bd4ef418ff201\n\nWe\u0027ve discussed the alternative to require kernel update.  To our understanding, there is no enforcement currently for OEMs to update their kernel on upgrading devices.  We\u0027ve made the kernel change this year, so in a few more years, we can revert these changes.  But for now, it\u0027s the only practical way.",
      "parentUuid": "20b1a55a_e0f5295f",
      "range": {
        "startLine": 60,
        "startChar": 50,
        "endLine": 60,
        "endChar": 70
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "91d17874_d1c86ff3",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1166043
      },
      "writtenOn": "2023-08-07T18:41:06Z",
      "side": 1,
      "message": "ah, ok. where do we allow apps to use MEASURE? assuming this would also require an selinux change?",
      "parentUuid": "fa63475f_b2489c91",
      "range": {
        "startLine": 60,
        "startChar": 50,
        "endLine": 60,
        "endChar": 70
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c1d0011d_afe34280",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-08-07T19:02:20Z",
      "side": 1,
      "message": "Yes, it\u0027s another sepolicy change.  I\u0027m just waiting for the ENABLE change to land first.",
      "parentUuid": "91d17874_d1c86ff3",
      "range": {
        "startLine": 60,
        "startChar": 50,
        "endLine": 60,
        "endChar": 70
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "45b5e4dd_c3312e53",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1137063
      },
      "writtenOn": "2023-08-07T19:02:45Z",
      "side": 1,
      "message": "\u003e Eric has fixed a bunch. You can find a list in this discussion on a Linux mailing list:\n\nJust to clarify, the specific fixes I listed were pretty old, and all kernels that support fsverity have them.  It\u0027s just the general complexity of PKCS#7 and history of vulnerabilities that continues to be concerning.\n\n\u003e We\u0027ve discussed the alternative to require kernel update. To our understanding, there is no enforcement currently for OEMs to update their kernel on upgrading devices. We\u0027ve made the kernel change this year, so in a few more years, we can revert these changes. But for now, it\u0027s the only practical way.\n\nI still plan to apply and backport my patch \"fsverity: skip PKCS#7 parser when keyring is empty\" (https://lore.kernel.org/r/20230802041503.11530-1-ebiggers@kernel.org).  That will remove the PKCS#7 attack surface from all supported kernel branches that have ever had fsverity support, assuming we can re-land https://r.android.com/2662658 which I think is possible.  Even if somehow we are unable to re-land https://r.android.com/2662658, we could instead add a new sysctl that forbids PKCS#7 on new files and make Android set that sysctl.\n\nI personally would lean towards just relying on that.  We can\u0027t continue to cater to OEMs who refuse to upgrade their kernel.  Outdated kernels have many known vulnerabilities anyway.",
      "parentUuid": "91d17874_d1c86ff3",
      "range": {
        "startLine": 60,
        "startChar": 50,
        "endLine": 60,
        "endChar": 70
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d63154ca_7e89b8f9",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1166043
      },
      "writtenOn": "2023-08-07T19:03:41Z",
      "side": 1,
      "message": "why can\u0027t we have a full feature as a single CL/topic? multiple CLs in different component leave the system in an inconsistent state, plus makes it very difficult to review and follow",
      "parentUuid": "c1d0011d_afe34280",
      "range": {
        "startLine": 60,
        "startChar": 50,
        "endLine": 60,
        "endChar": 70
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "59251fc4_04d12303",
        "filename": "private/installd.te",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-08-07T19:10:07Z",
      "side": 1,
      "message": "It\u0027s easier to make progress... If you really prefer, I can publish/add changes on top of the existing ones when ready.  But over time it can require extra work to resolve conflict, etc.  A smaller change is easier to revert when we unexpected broke someone\u0027s tests.",
      "parentUuid": "d63154ca_7e89b8f9",
      "range": {
        "startLine": 60,
        "startChar": 50,
        "endLine": 60,
        "endChar": 70
      },
      "revId": "a6823c0e8251cf432e84145b7aa1f295e56a3487",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}