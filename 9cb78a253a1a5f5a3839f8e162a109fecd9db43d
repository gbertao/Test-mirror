{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "2db2d7db_7ac62989",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-04-30T20:15:27Z",
      "side": 1,
      "message": "+Jiyong/Inseob for properties double-check.",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6a8f48a2_ee84b1c9",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-04-30T20:42:52Z",
      "side": 1,
      "message": "This should already be allowed for all apps.",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6e1ab0dc_f695cf94",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1082465
      },
      "writtenOn": "2021-04-30T23:10:19Z",
      "side": 1,
      "message": "Will all devices also be expected to define a gpu_device?",
      "parentUuid": "6a8f48a2_ee84b1c9",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "14baee94_4a020ced",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1120612
      },
      "writtenOn": "2021-04-30T23:19:23Z",
      "side": 1,
      "message": "Thank Joel, deleted the statement for both permissioncontroller_app and mediaprovider_app. Lingfeng, sorry I do not know the answer to that. The type itself is pulbic though so my guess is that it should be ok for a device to not define it.",
      "parentUuid": "6e1ab0dc_f695cf94",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7fbbbd9b_50848e35",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-04-30T20:15:27Z",
      "side": 1,
      "message": "Do you know why these are needed?",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5a004bc8_efb138cc",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1120612
      },
      "writtenOn": "2021-04-30T20:31:58Z",
      "side": 1,
      "message": "Thanks Joel. the original patch which added the permission to system_ext(aosp/1344276) cites b/146515640 and b/158011535 as reasons for adding the permission. Without moving the permission here, cuttlefish will fail several CTS-on-GSI tests(for example: b/186116877).",
      "parentUuid": "7fbbbd9b_50848e35",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef3033fe_200a9a3c",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-04-30T20:42:52Z",
      "side": 1,
      "message": "Thanks, that\u0027s interesting.  I only see denials for gpu_device in those, though; do you know if graphics_device is also needed?",
      "parentUuid": "5a004bc8_efb138cc",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3f37e5b3_c9207297",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1120612
      },
      "writtenOn": "2021-04-30T20:58:25Z",
      "side": 1,
      "message": "Sorry Joel, no, I do not know if graphics_device is needed. I assumed it was since aosp/1344276 added it. Jason, can you please take a look and let us know? Thanks you!",
      "parentUuid": "ef3033fe_200a9a3c",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "04f9a858_b616502c",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1082465
      },
      "writtenOn": "2021-04-30T21:26:38Z",
      "side": 1,
      "message": "Hi, I\u0027m the one who originally added it. I agree with Bowgo\u0027s take above that this should go in device/google/cuttlefish/shared/sepolicy/vendor as this will be specific to Cuttlefish (graphics_device and gpu_device are defined in there).",
      "parentUuid": "3f37e5b3_c9207297",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8a949146_08c287b5",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1120612
      },
      "writtenOn": "2021-04-30T22:18:29Z",
      "side": 1,
      "message": "permissioncontroller_app(and the other domains in this patch) are not public domains though. They are not available for use with vendor sepolicy currently, which is why I added them here. Does it really need the access to graphics_device Lingfeng?",
      "parentUuid": "04f9a858_b616502c",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2e7a9c92_b61a7992",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1082465
      },
      "writtenOn": "2021-04-30T23:10:19Z",
      "side": 1,
      "message": "True, permissioncontroller_app doesn\u0027t look like it needs graphics_device. That was more because it was simpler to use the single gpu_access macro.",
      "parentUuid": "8a949146_08c287b5",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d8784b00_f9866d6f",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1120612
      },
      "writtenOn": "2021-04-30T23:19:23Z",
      "side": 1,
      "message": "Thanks Lingfeng, deleted the perms to graphic_device here and added back the gpu_access(*) permissions to the cf system_ext sepolicy just to be safe.",
      "parentUuid": "2e7a9c92_b61a7992",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2fa72a1b_b997fe73",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-04-30T23:51:21Z",
      "side": 1,
      "message": "I still don\u0027t understand from those bugs why gpu_device access is needed, especially for permissioncontroller.  Do you know why?",
      "parentUuid": "d8784b00_f9866d6f",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c836c2f7_7ecdec16",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1082465
      },
      "writtenOn": "2021-05-01T00:03:24Z",
      "side": 1,
      "message": "permissioncontroller has UI, and the UI needs to access the gpu device to draw the UI.",
      "parentUuid": "2fa72a1b_b997fe73",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4acf3b03_c2baeff3",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-05-01T00:10:34Z",
      "side": 1,
      "message": "This is just the directory, not the files themselves: all apps already have access to those.",
      "parentUuid": "c836c2f7_7ecdec16",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c45476ed_3faa4918",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1082465
      },
      "writtenOn": "2021-05-03T17:26:49Z",
      "side": 1,
      "message": "I\u0027m not sure what is meant by directory versus file; I was also under the impression all apps should have access to gpu device, but maybe things work differently for permissioncontroller and other apps?\n\n```\n04-30 17:01:58.680  1646  1646 W RenderThread: type\u003d1400 audit(0.0:139): avc: denied { search } for name\u003d\"dri\" dev\u003d\"tmpfs\" ino\u003d333 scontext\u003du:r:permissioncontroller_app:s0:c126,c256,c512,c768 tcontext\u003du:object_r:gpu_device:s0 tclass\u003ddir permissive\u003d0 app\u003dcom.android.permissioncontroller\n```\n\nThis was the denial message, btw. My understanding is if you can\u0027t access the gpu device, then you can\u0027t render, since you can\u0027t initialize EGL contexts and so forth.",
      "parentUuid": "4acf3b03_c2baeff3",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "87ab066d_30094ded",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-05-03T17:43:55Z",
      "side": 1,
      "message": "Note the \"tclass\u003ddir\" part there.  That means it\u0027s trying to access the directory, not the files themselves (to which it presumably already granted access).  Nothing else in core or Pixel policy has these permissions, so they\u0027re quite uncommon.  Is there anything in the logs about what files or directories they\u0027re trying to access?",
      "parentUuid": "c45476ed_3faa4918",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b9b5b6f2_a77a5dbe",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1082465
      },
      "writtenOn": "2021-05-03T19:00:47Z",
      "side": 1,
      "message": "From what I can tell, that just seem to happen as a side effect when opening the gpu device via drmOpenRender. But things happen the same way here across all apps. There seems to be a divergence in policy for apps versus apps like permissioncontroller?",
      "parentUuid": "87ab066d_30094ded",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4424405b_29006d92",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-05-03T19:06:52Z",
      "side": 1,
      "message": "Yes, that seems strange.  Could this behavior thus be Cuttlefish-specific?  Is there then any way to keep it in Cuttlefish directories?",
      "parentUuid": "b9b5b6f2_a77a5dbe",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "20cdf9ae_c860df07",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1082465
      },
      "writtenOn": "2021-05-03T19:23:18Z",
      "side": 1,
      "message": "I don\u0027t think this would exactly be Cuttlefish-specific because the denials seem to be triggered by anyone who uses libdrm or the set of related libraries like minigbm, which ship in physical devices too IIRC. Let me continue to try to trace this down...",
      "parentUuid": "4424405b_29006d92",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d1313692_13676d7e",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1082465
      },
      "writtenOn": "2021-05-03T19:44:26Z",
      "side": 1,
      "message": "https://android.googlesource.com/platform/external/minigbm/+/refs/heads/master/cros_gralloc/cros_gralloc_driver.cc#74 This would be where the denial is triggered in this case. A test open is done on the DRM_DIR_NAME.\n\nThis is going to happen for any user of the minigbm mapper/allocator driver, not limited to Cuttlefish.",
      "parentUuid": "20cdf9ae_c860df07",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8d65d7ac_ba588e53",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1082465
      },
      "writtenOn": "2021-05-03T20:03:11Z",
      "side": 1,
      "message": "As for moving it into Cuttlefish, I\u0027m still open to that, but, my understanding now is, the problem is that it can\u0027t be in the Cuttlefish dir because we need to test against generic system_ext, right?",
      "parentUuid": "d1313692_13676d7e",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1c239a8f_66733a33",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1120612
      },
      "writtenOn": "2021-05-03T20:10:46Z",
      "side": 1,
      "message": "That is correct, when booting GSI, only the vendor sepolicy comes into effect. All the domains in this patch are private though(not visible on the vendor side of the Treble boundary). Hence, we do not have a way to add these permissions to CF\u0027s vendor sepolicy.",
      "parentUuid": "8d65d7ac_ba588e53",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "db9760ef_93b0c505",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-05-03T20:16:58Z",
      "side": 1,
      "message": "Ooh, nice find.  Still, it looks like Cuttlefish is currently the only user of that library.  Is that intended to change in the future?  Because currently this does still seem like device-specific policy.\n\nAs for GSI, what exactly is the issue?  Obviously all devices including Cuttlefish will still need to load device-specific policy (e.g., for hardware nodes that have different names on different devices).  Is it just that no one will be allowed to modify private types?",
      "parentUuid": "1c239a8f_66733a33",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1865cf5c_7ffaa2ee",
        "filename": "private/permissioncontroller_app.te",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1120612
      },
      "writtenOn": "2021-05-03T20:28:13Z",
      "side": 1,
      "message": "So far, cuttlefish had this permission as part of its system_ext sepolicy(https://cs.android.com/android/platform/superproject/+/master:device/google/cuttlefish/shared/sepolicy/system_ext/private/permissioncontroller_app.te) However, when a device boots GSI it is not allowed to load device-specific system_ext sepolicy. All device-specific sepolicy perms needed for CTS/VTS-on-GSI compliance must live in vendor sepolicy which will still come into effect for GSI testing. Vendor sepolicy(unlike system-ext sepolicy) does not have visibility into the private domains of system/sepolicy though(hence the need for the permissions to be in system/sepolicy).",
      "parentUuid": "db9760ef_93b0c505",
      "revId": "9cb78a253a1a5f5a3839f8e162a109fecd9db43d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}