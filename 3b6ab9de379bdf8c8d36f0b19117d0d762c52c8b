{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "b9d6935a_9206644b",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-01-13T10:02:36Z",
      "side": 1,
      "message": "It would probably be better to use hal_automotive_socket_exemption here, as below; this also seems like it shouldn\u0027t happen on non-auto builds.\n\nBut it\u0027s not clear to me that the exemption should be extended to this neverallow. I\u0027ll leave it to @jeffv@google.com to decide.",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9917eb6c_d9fa0ed8",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2023-01-13T11:07:09Z",
      "side": 1,
      "message": "Let\u0027s ask the Core networking team if this is acceptable. Generally only core networking code should be allowed to modify network settings. This appears to break that assumption.\n\n+lorenzo@ and +maze@ to comment.",
      "parentUuid": "b9d6935a_9206644b",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e38c131b_9bcb3712",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1003247
      },
      "writtenOn": "2023-01-13T12:06:37Z",
      "side": 1,
      "message": "Yeah, I\u0027m not following why this is a good idea to do - *especially* so in non-auto-specific logic...\n\nWhat specific setsockopt(s) requires net_raw?\nIs there a design doc / discussion for this somewhere?\nI tried following the link to the bug, but that doesn\u0027t seem useful...\nWhy can\u0027t this use normal Android access permission model for binding to networks?\n\nAlso why does this also allow net_admin?\n(does this mean a separate neverallow for net_admin should be added?)",
      "parentUuid": "9917eb6c_d9fa0ed8",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "02acc07e_f7ea4381",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1219061
      },
      "writtenOn": "2023-01-13T18:08:49Z",
      "side": 1,
      "message": "Yes, we only need net_raw, I can add a never allow rule for net_admin.\n\nThe reason we need this is for this CL: ag/20964735 to work. Specifically, we use the grpc\u0027s SetSocketMutator function. We need to use setsockopt(SO_BINDTODEVICE) to bind the socket fd to a specific interface.",
      "parentUuid": "e38c131b_9bcb3712",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2913926b_f246420e",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1003247
      },
      "writtenOn": "2023-01-13T18:25:03Z",
      "side": 1,
      "message": "Hah, so I happened to learn about this yesterday, due to a forward porting bug of a patch I wrote for prodkernel being incorrectly applied to 5.15, but:\n\nhttps://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id\u003dc427bfec18f2190b8f4718785ee8ed2db4f84ee6\n\nnet: core: enable SO_BINDTODEVICE for non-root users\n\nWhich is in Linux ~5.6..5.7 so in Pixel 6+\n\n---\n\nNow a separate question is whether we\u0027re actually OK with this change for Android... since it might break some network binding assumptions.",
      "parentUuid": "02acc07e_f7ea4381",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9644254d_6bbff9fe",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1003247
      },
      "writtenOn": "2023-01-13T18:29:32Z",
      "side": 1,
      "message": "btw. I expect you should fix grpc to use android ndk network socket binding primitives.",
      "parentUuid": "2913926b_f246420e",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "32524175_38054584",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1219061
      },
      "writtenOn": "2023-01-13T18:35:07Z",
      "side": 1,
      "message": "Can you point me to the ndk network socket binding primitives? Do you mean if I use that I do not need NET_RAW permission?",
      "parentUuid": "9644254d_6bbff9fe",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9e6d4464_463c5f4d",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1003247
      },
      "writtenOn": "2023-01-13T18:54:24Z",
      "side": 1,
      "message": "https://source.corp.google.com/aosp-master/frameworks/native/include/android/multinetwork.h;l\u003d72\n\n/**\n * Set the network to be used by the given socket file descriptor.\n *\n * To clear a previous socket binding, invoke with NETWORK_UNSPECIFIED.\n *\n * This is the equivalent of: [android.net.Network#bindSocket()](https://developer.android.com/reference/android/net/Network.html#bindSocket(java.net.Socket))\n *\n * Available since API level 23.\n */\nint android_setsocknetwork(net_handle_t network, int fd) __INTRODUCED_IN(23);",
      "parentUuid": "32524175_38054584",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ed1860e6_9b0055b1",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-01-19T19:00:54Z",
      "side": 1,
      "message": "This doesn\u0027t require any changes in gRPC, just the same socket mutator as in http://ag/20964735\n\nThe tedious (as in: more code) part is that it requires selecting a network and not picking via interface name. The benefit would be making this more reliable on Android, probably.",
      "parentUuid": "9e6d4464_463c5f4d",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74969a23_f97b21ac",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1219061
      },
      "writtenOn": "2023-01-19T19:16:16Z",
      "side": 1,
      "message": "Yes, that API is helpful. The issue here is how to get the network_handle_t which requires java code. We do not have java code in remote access HAL so it would need to be passed down from remote access service.",
      "parentUuid": "ed1860e6_9b0055b1",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0088212b_5c9c47c9",
        "filename": "public/hal_neverallows.te",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-01-19T19:24:29Z",
      "side": 1,
      "message": "Ouch, seriously? This will be a problem with our other project!",
      "parentUuid": "74969a23_f97b21ac",
      "range": {
        "startLine": 7,
        "startChar": 3,
        "endLine": 7,
        "endChar": 26
      },
      "revId": "3b6ab9de379bdf8c8d36f0b19117d0d762c52c8b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}