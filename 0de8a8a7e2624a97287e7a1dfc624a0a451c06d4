{
  "comments": [
    {
      "key": {
        "uuid": "4a46c48b_0fbfe599",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2018-11-08T15:16:41Z",
      "side": 1,
      "message": "The message here is inconsistent with the change. In particular, this also allows apexd to manipulate files in /data/app, which is more than just communication.",
      "revId": "0de8a8a7e2624a97287e7a1dfc624a0a451c06d4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e29116f3_41653ecf",
        "filename": "private/apexd.te",
        "patchSetId": 6
      },
      "lineNbr": 16,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2018-11-08T15:16:41Z",
      "side": 1,
      "message": "This allows apexd to manipulate (delete, rename) files in /data/app, which feels like something only packagemanager should be doing.",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 16,
        "endChar": 0
      },
      "revId": "0de8a8a7e2624a97287e7a1dfc624a0a451c06d4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a74adef9_fe25358e",
        "filename": "private/apexd.te",
        "patchSetId": 6
      },
      "lineNbr": 16,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2018-11-08T15:17:14Z",
      "side": 1,
      "message": "can you get someone from the package manager team to review this change?",
      "parentUuid": "e29116f3_41653ecf",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 16,
        "endChar": 0
      },
      "revId": "0de8a8a7e2624a97287e7a1dfc624a0a451c06d4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86f7a80a_71332167",
        "filename": "private/apexd.te",
        "patchSetId": 6
      },
      "lineNbr": 16,
      "author": {
        "id": 1305591
      },
      "writtenOn": "2018-11-08T15:18:23Z",
      "side": 1,
      "message": "Thanks! Will ask toddke@",
      "parentUuid": "a74adef9_fe25358e",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 16,
        "endChar": 0
      },
      "revId": "0de8a8a7e2624a97287e7a1dfc624a0a451c06d4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "00e52b41_ade8ad58",
        "filename": "private/apexd.te",
        "patchSetId": 6
      },
      "lineNbr": 16,
      "author": {
        "id": 1060678
      },
      "writtenOn": "2018-11-09T14:58:26Z",
      "side": 1,
      "message": "Historically, we\u0027ve only provided installd with the ability to manipulate files in /data/app. system server can\u0027t even do this.",
      "parentUuid": "86f7a80a_71332167",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 16,
        "endChar": 0
      },
      "revId": "0de8a8a7e2624a97287e7a1dfc624a0a451c06d4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "12a36e39_5bef5f42",
        "filename": "private/apexd.te",
        "patchSetId": 6
      },
      "lineNbr": 16,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2018-11-11T15:29:47Z",
      "side": 1,
      "message": "APK files are really sensitive files because they contain downloadable executable code, and the install process for APKs is already complicated enough without having to worry about other processes tweaking with the /data/app directory. \n\nAs a general rule, every directory should be owned by exactly one process, and the owner of /data/app is installd.",
      "parentUuid": "00e52b41_ade8ad58",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 16,
        "endChar": 0
      },
      "revId": "0de8a8a7e2624a97287e7a1dfc624a0a451c06d4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "655d35f2_acb20616",
        "filename": "private/apexd.te",
        "patchSetId": 6
      },
      "lineNbr": 16,
      "author": {
        "id": 1305591
      },
      "writtenOn": "2018-11-12T19:02:59Z",
      "side": 1,
      "message": "ack, will check if I can make it work with read-only permission. thanks for the review!",
      "parentUuid": "12a36e39_5bef5f42",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 16,
        "endChar": 0
      },
      "revId": "0de8a8a7e2624a97287e7a1dfc624a0a451c06d4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b4f41fa7_c06a9f16",
        "filename": "private/apexd.te",
        "patchSetId": 6
      },
      "lineNbr": 16,
      "author": {
        "id": 1305591
      },
      "writtenOn": "2018-11-12T19:42:19Z",
      "side": 1,
      "message": "it turns out the write/remove permission in apk_data_file wasn\u0027t needed (I got the suggestion from audit2allow, sorry for not trying to restrict further).\n\nI left only the search permission on apk_data_file, since that seems to be needed. The write permission on apk_tmp_file is to allow apexd to move files to its own directory instead of copying, to avoid waste of space. I could hardlink instead, and let PackageInstaller clear apk_tmp_file:dir at the end of the session, but the problem would then be that the package file owner would be system:system, whereas apexd is running as root:system.\n\nNote that we\u0027re trying to avoid granting dac_override, so apexd won\u0027t likely be able to change owner of the file.",
      "parentUuid": "655d35f2_acb20616",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 16,
        "endChar": 0
      },
      "revId": "0de8a8a7e2624a97287e7a1dfc624a0a451c06d4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5c79c550_df183799",
        "filename": "private/apexd.te",
        "patchSetId": 6
      },
      "lineNbr": 16,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2018-11-12T20:23:07Z",
      "side": 1,
      "message": "Package manager should pass a file descriptor to apexd so that apexd could copy the file itself. It seems like the code is passing files by name, not by file descriptor.  If you have the file descriptor then it\u0027s straight forward to copy the contents of the file.",
      "parentUuid": "b4f41fa7_c06a9f16",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 16,
        "endChar": 0
      },
      "revId": "0de8a8a7e2624a97287e7a1dfc624a0a451c06d4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}