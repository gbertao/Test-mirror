{
  "comments": [
    {
      "key": {
        "uuid": "5a3fa4e7_ac45a560",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1038039
      },
      "writtenOn": "2020-09-30T12:59:56Z",
      "side": 1,
      "message": "For reference: http://ag/q/topic:%22time_manager_api%22+(status:open%20OR%20status:merged) is the internal topic ",
      "revId": "804329881fa4f82451d17bb68aaae3316384c4f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4215a366_647f6da5",
        "filename": "public/service.te",
        "patchSetId": 1
      },
      "lineNbr": 186,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2020-10-01T20:49:41Z",
      "side": 1,
      "message": "This makes it available to all third party apps. Can you instead limit access to just the shell user?\n\nallow shell timzonedetector_service:service_manager find;",
      "range": {
        "startLine": 186,
        "startChar": 31,
        "endLine": 186,
        "endChar": 46
      },
      "revId": "804329881fa4f82451d17bb68aaae3316384c4f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5937f1ed_cf4c6a08",
        "filename": "public/service.te",
        "patchSetId": 1
      },
      "lineNbr": 186,
      "author": {
        "id": 1038039
      },
      "writtenOn": "2020-10-02T17:07:49Z",
      "side": 1,
      "message": "Sorry, my selinux knowledge is pretty poor, so I might not understand exactly what you mean / where to put things\n\nI thought the issue here was that the process is running a CTS apk and \"borrowing\" the shell permissions, not that the test is actually running as the shell process. I could be wrong.\n\nFWIW, I tried removing my service.te change and adding the line:\n\n+++ b/public/shell.te\n@@ -89,6 +89,7 @@ allow shell {\n   -vold_service\n   -vr_hwc_service\n   -default_android_service\n+  timezonedetector_service\n }:service_manager find;\n allow shell dumpstate:binder call;\n\n\nto shell.te, but it built but didn\u0027t work.\n\nFYI - I also tried with a leading \"-\" in case my assumptions about the \"-\" syntax meaning \"deny\" were bad, but to no effect.\n\nHere\u0027s the error from logcat (both looked the same):\n\n10-02 17:55:32.909   587   587 E SELinux : avc:  denied  { find } for pid\u003d8918 uid\u003d10270 name\u003dtime_zone_detector scontext\u003du:r:untrusted_app:s0:c14,c257,c512,c768 tcontext\u003du:object_r:timezonedetector_service:s0 tclass\u003dservice_manager permissive\u003d0\n\n\nIs there something else I can try?",
      "parentUuid": "4215a366_647f6da5",
      "range": {
        "startLine": 186,
        "startChar": 31,
        "endLine": 186,
        "endChar": 46
      },
      "revId": "804329881fa4f82451d17bb68aaae3316384c4f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "733287c0_e7d96b2c",
        "filename": "public/service.te",
        "patchSetId": 1
      },
      "lineNbr": 186,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2020-10-02T17:23:21Z",
      "side": 1,
      "message": "I misunderstood as well. I thought you meant you were running tests as \"adb shell\". FWIW, CTS has the idea of \"hostside\" tests. See cts/hostside for many many examples. These tests run on the device as the \"adb shell\" user. This is a great place to put tests for privileged functionality that should not be reachable by regular apps. The downside of running your test as a regular CTS test is that it runs in the same sandbox as any other third-party app. So we have to expose privileged functionality to apps which is generally a bad security practice.\n\nWould it be possible to move your test to a hostside test?",
      "parentUuid": "5937f1ed_cf4c6a08",
      "range": {
        "startLine": 186,
        "startChar": 31,
        "endLine": 186,
        "endChar": 46
      },
      "revId": "804329881fa4f82451d17bb68aaae3316384c4f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b07416a7_5888400a",
        "filename": "public/service.te",
        "patchSetId": 1
      },
      "lineNbr": 186,
      "author": {
        "id": 1038039
      },
      "writtenOn": "2020-10-02T17:55:50Z",
      "side": 1,
      "message": "AFAIK, I\u0027m just doing what others are doing for this case for CTS testing privileged APIs.\n\nMaking them host tests would be awkward, wouldn\u0027t it? I\u0027m testing the client API code, how would I invoke the code?\n\nI\u0027ve alluded in the commit comment to the fact that the service may well become public in future too, but it\u0027s true that third-party apps isn\u0027t necessary at this point in time.\n\nI\u0027ll start a thread.",
      "parentUuid": "733287c0_e7d96b2c",
      "range": {
        "startLine": 186,
        "startChar": 31,
        "endLine": 186,
        "endChar": 46
      },
      "revId": "804329881fa4f82451d17bb68aaae3316384c4f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}