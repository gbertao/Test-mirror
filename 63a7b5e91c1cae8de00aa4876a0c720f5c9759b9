{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "781c7690_1f961efc",
        "filename": "private/otapreopt_chroot.te",
        "patchSetId": 2
      },
      "lineNbr": 104,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-08-04T15:43:15Z",
      "side": 1,
      "message": "I found that when switching to the binary in /postinstall/system/bin/otapreopt_chroot, these allows are necessary for a clean run. The exact same (updated) binary doesn\u0027t need them when run from /system/bin. These are the sepolicy errors I get, and they all occur before even the first line of `android::installd::otapreopt_chroot` is executed, but the binary still runs fine:\n\n```\n08-04 14:05:34.233 18115 18115 W otapreopt_chroo: type\u003d1400 audit(0.0:252): avc:  denied  { read } for  name\u003d\"bin\" dev\u003d\"dm-13\" ino\u003d320640 scontext\u003du:r:otapreopt_chroot:s0 tcontext\u003du:object_r:vendor_file:s0 tclass\u003ddir permissive\u003d0\n08-04 14:05:34.233 18115 18115 W otapreopt_chroo: type\u003d1400 audit(0.0:253): avc:  denied  { search } for  name\u003d\"tmp\" dev\u003d\"dm-62\" ino\u003d96 scontext\u003du:r:otapreopt_chroot:s0 tcontext\u003du:object_r:shell_data_file:s0 tclass\u003ddir permissive\u003d0\n08-04 15:25:25.358 11308 11308 W otapreopt_chroo: type\u003d1400 audit(0.0:300): avc:  denied  { search } for  name\u003d\"tests\" dev\u003d\"dm-62\" ino\u003d106 scontext\u003du:r:otapreopt_chroot:s0 tcontext\u003du:object_r:shell_test_data_file:s0 tclass\u003ddir permissive\u003d0\n```\n\nThe first one is for `/vendor/bin`, the second one is for `/data/local/tmp`, and the third (which I\u0027ve only gotten once) is for `/data/local/tests`. Got any ideas why this happens?\n\nI don\u0027t expect to actually submit these lines - the one for the tmp dir is even blocked by a [`neverallow` rule](https://cs.android.com/android/platform/superproject/main/+/main:system/sepolicy/private/domain.te;l\u003d732-745;drc\u003d486fa9fb0a53f9ce6edb04295f4bec8b0acca0cb).",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 104,
        "endChar": 44
      },
      "revId": "63a7b5e91c1cae8de00aa4876a0c720f5c9759b9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5fde307b_3cbf70b1",
        "filename": "private/otapreopt_chroot.te",
        "patchSetId": 2
      },
      "lineNbr": 104,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2023-08-04T16:15:05Z",
      "side": 1,
      "message": "No idea, but we probably don\u0027t need these since the binary runs fine. Maybe add `dontaudit` instead?",
      "parentUuid": "781c7690_1f961efc",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 104,
        "endChar": 44
      },
      "revId": "63a7b5e91c1cae8de00aa4876a0c720f5c9759b9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "526a2dfa_0d98f08e",
        "filename": "private/otapreopt_chroot.te",
        "patchSetId": 2
      },
      "lineNbr": 104,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-08-04T16:18:00Z",
      "side": 1,
      "message": "Maybe, but I\u0027d like to know what\u0027s going on first. +alanstokes@, do you have any idea?",
      "parentUuid": "5fde307b_3cbf70b1",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 104,
        "endChar": 44
      },
      "revId": "63a7b5e91c1cae8de00aa4876a0c720f5c9759b9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96682597_9f9a8778",
        "filename": "private/otapreopt_chroot.te",
        "patchSetId": 2
      },
      "lineNbr": 104,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-08-04T16:42:23Z",
      "side": 1,
      "message": "Well, tbh, no. Especially /vendor/bin.\nAre the binaries definitely identical? There isn\u0027t a bootstrap / non-bootstrap difference, say?\nSome weird LD_LIBRARY_PATH thing?\nHow exactly is the binary run?",
      "parentUuid": "526a2dfa_0d98f08e",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 104,
        "endChar": 44
      },
      "revId": "63a7b5e91c1cae8de00aa4876a0c720f5c9759b9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}