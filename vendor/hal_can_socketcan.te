type hal_can_socketcan, domain;
hal_server_domain(hal_can_socketcan, hal_can_controller)
hal_server_domain(hal_can_socketcan, hal_can_bus)

type hal_can_socketcan_exec, exec_type, vendor_file_type, file_type;
init_daemon_domain(hal_can_socketcan)

# Managing SocketCAN interfaces
allow hal_can_socketcan self:netlink_route_socket { create bind write nlmsg_write read };
allow hal_can_socketcan self:udp_socket { create ioctl };
allow hal_can_socketcan self:capability { net_admin sys_module };
allow hal_can_socketcan kernel:system module_request;
allowxperm hal_can_socketcan self:udp_socket ioctl {
    SIOCGIFFLAGS
    SIOCSIFFLAGS
    SIOCGIFINDEX
};

# Communicating with SocketCAN interfaces
allow hal_can_socketcan self:can_socket { bind create read write };

# Un-publishing ICanBus interfaces
allow hal_can_socketcan hidl_manager_hwservice:hwservice_manager find;
