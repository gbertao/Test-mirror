{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "acf1e8dd_faa2ce1e",
        "filename": "public/te_macros",
        "patchSetId": 2
      },
      "lineNbr": 195,
      "author": {
        "id": 1380243
      },
      "writtenOn": "2022-02-23T17:38:13Z",
      "side": 1,
      "message": "Why does virtualizationservice need to write to the pipe? Shouldn\u0027t it just be crosvm doing that?",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 29
      },
      "revId": "23161e51cc6258abae5b49149cbbded53d3bd79c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d790e3c_d01f7b48",
        "filename": "public/te_macros",
        "patchSetId": 2
      },
      "lineNbr": 195,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-02-24T00:35:04Z",
      "side": 1,
      "message": "+1 to Andrew. VS just passes the FDs. It doesn\u0027t read/write on them.",
      "parentUuid": "acf1e8dd_faa2ce1e",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 29
      },
      "revId": "23161e51cc6258abae5b49149cbbded53d3bd79c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f16c54fa_d924f21b",
        "filename": "public/te_macros",
        "patchSetId": 2
      },
      "lineNbr": 195,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-02-24T09:05:46Z",
      "side": 1,
      "message": "The client passes the FD to VS which then passes it to crosvm.\nAccess for FDs is checked on open not on read/write, so for VS to simply have an FD open with write access it needs write permission.\n(And the client doesn\u0027t really care.)",
      "parentUuid": "1d790e3c_d01f7b48",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 29
      },
      "revId": "23161e51cc6258abae5b49149cbbded53d3bd79c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e800b309_3e133a67",
        "filename": "public/te_macros",
        "patchSetId": 2
      },
      "lineNbr": 195,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-02-24T09:13:34Z",
      "side": 1,
      "message": "And more pragmatically: it doesn\u0027t work without it.",
      "parentUuid": "f16c54fa_d924f21b",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 29
      },
      "revId": "23161e51cc6258abae5b49149cbbded53d3bd79c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1d30c580_dfc8f38d",
        "filename": "public/te_macros",
        "patchSetId": 2
      },
      "lineNbr": 195,
      "author": {
        "id": 1380243
      },
      "writtenOn": "2022-02-24T09:39:36Z",
      "side": 1,
      "message": "That\u0027s not what happens with all the other FDs which virtualizationservice passes around, it just needs `fd use`. What system call is failing for virtualizationservice without the write permission?",
      "parentUuid": "e800b309_3e133a67",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 29
      },
      "revId": "23161e51cc6258abae5b49149cbbded53d3bd79c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a9272e5d_d4fd464f",
        "filename": "public/te_macros",
        "patchSetId": 2
      },
      "lineNbr": 195,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-02-24T09:51:57Z",
      "side": 1,
      "message": "We do grant VS access to other files that are passed via fd - e.g. https://cs.android.com/android/platform/superproject/+/master:system/sepolicy/private/virtualizationservice.te;drc\u003d7e07941d3d9911c5671239a8abb2632ab30e8e69;l\u003d37",
      "parentUuid": "1d30c580_dfc8f38d",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 29
      },
      "revId": "23161e51cc6258abae5b49149cbbded53d3bd79c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6fda83b_3e567e45",
        "filename": "public/te_macros",
        "patchSetId": 2
      },
      "lineNbr": 195,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-02-24T09:52:55Z",
      "side": 1,
      "message": "Other clients of VS like the `vm` tool and the demo app don\u0027t have this problem; console log is correctly piped. Any thoughts?",
      "parentUuid": "1d30c580_dfc8f38d",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 29
      },
      "revId": "23161e51cc6258abae5b49149cbbded53d3bd79c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "65219aec_2b0c2b38",
        "filename": "public/te_macros",
        "patchSetId": 2
      },
      "lineNbr": 195,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-02-24T10:06:50Z",
      "side": 1,
      "message": "vm doesn\u0027t create a pipe - it uses either a file or its own stdout (which is covered by the adbd grant, I guess?): https://cs.android.com/android/platform/superproject/+/master:packages/modules/Virtualization/vm/src/run.rs;drc\u003db7983a2683ffb5ce6fea51d8de38a15c31323f67;l\u003d171\n\nAnd the demo app works because of this: https://cs.android.com/android/platform/superproject/+/master:system/sepolicy/private/binderservicedomain.te;drc\u003d144c822018006244e6cb4f3a538fbb13df56d058;l\u003d15\n\n(I admit I\u0027d never have guessed that one - I had to use sesearch.)",
      "parentUuid": "a6fda83b_3e567e45",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 29
      },
      "revId": "23161e51cc6258abae5b49149cbbded53d3bd79c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}