{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e9149735_77bc055b",
        "filename": "microdroid/system/private/dex2oat.te",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-08-11T07:23:52Z",
      "side": 1,
      "message": "I don\u0027t understand this. What happens if this doesn\u0027t exist?",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 12,
        "endChar": 45
      },
      "revId": "a0cceb7c827fa205099a1da8fae78dd90c0b4755",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "791b3b80_179d37ce",
        "filename": "microdroid/system/private/dex2oat.te",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2021-08-11T17:44:43Z",
      "side": 1,
      "message": "The compiler will fail to read the input / write the output.\n\n[   17.047093][  T172] type\u003d1400 audit(1628702854.868:3): avc: denied { read } for comm\u003d\"dex2oat64\" path\u003d\"/data/misc/authfs/1/3\" dev\u003d\"fuse\" ino\u003d3 scontext\u003du:r:dex2oat:s0 tcontext\u003du:object_r:authfs_fuse:s0 tclass\u003dfile permissive\u003d1\n[   17.063150][  T172] type\u003d1400 audit(1628702854.868:4): avc: denied { write } for comm\u003d\"dex2oat64\" path\u003d\"/data/misc/authfs/1/24\" dev\u003d\"fuse\" ino\u003d24 scontext\u003du:r:dex2oat:s0 tcontext\u003du:object_r:authfs_fuse:s0 tclass\u003dfile permissive\u003d1\n[   17.219774][  T172] type\u003d1400 audit(1628702855.044:5): avc: denied { getattr } for comm\u003d\"dex2oat64\" path\u003d\"/data/misc/authfs/1/3\" dev\u003d\"fuse\" ino\u003d3 scontext\u003du:r:dex2oat:s0 tcontext\u003du:object_r:authfs_fuse:s0 tclass\u003dfile permissive\u003d1\n[   17.289341][  T172] type\u003d1400 audit(1628702855.112:6): avc: denied { open } for comm\u003d\"dex2oat64\" path\u003d\"/data/misc/authfs/1/4\" dev\u003d\"fuse\" ino\u003d4 scontext\u003du:r:dex2oat:s0 tcontext\u003du:object_r:authfs_fuse:s0 tclass\u003dfile permissive\u003d1\n[   17.323179][  T172] type\u003d1400 audit(1628702855.148:7): avc: denied { map } for comm\u003d\"dex2oat64\" path\u003d\"/data/misc/authfs/1/5\" dev\u003d\"fuse\" ino\u003d5 scontext\u003du:r:dex2oat:s0 tcontext\u003du:object_r:authfs_fuse:s0 tclass\u003dfile permissive\u003d1",
      "parentUuid": "e9149735_77bc055b",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 12,
        "endChar": 45
      },
      "revId": "a0cceb7c827fa205099a1da8fae78dd90c0b4755",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e3d9cc12_51e86e56",
        "filename": "microdroid/system/private/dex2oat.te",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-08-12T08:41:41Z",
      "side": 1,
      "message": "Ok, but why is \u0027open\u0027 needed? From the slide you shared, dex2oat seems to use FDs as inputs/outputs, not the paths under /data/misc/authfs.\n\nIs this something you will eventually fix?",
      "parentUuid": "791b3b80_179d37ce",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 12,
        "endChar": 45
      },
      "revId": "a0cceb7c827fa205099a1da8fae78dd90c0b4755",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5a4047f8_6ec1a19d",
        "filename": "microdroid/system/private/dex2oat.te",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-08-12T08:42:10Z",
      "side": 1,
      "message": "If so, I am happy to submit this as it is.",
      "parentUuid": "e3d9cc12_51e86e56",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 12,
        "endChar": 45
      },
      "revId": "a0cceb7c827fa205099a1da8fae78dd90c0b4755",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc69ba61_5c7cb04b",
        "filename": "microdroid/system/private/dex2oat.te",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2021-08-12T14:08:55Z",
      "side": 1,
      "message": "Ah, I didn\u0027t notice the denial of open.  I\u0027ve seen dex2oat trying to resolve a path (possibly a symlink) with realpath. bionic\u0027s realpath implementation opens from /proc/self/fd/$FD, and in this case, it\u0027s open the symlink to authfs... But I\u0027ll need to dig deeper to be sure.\n\nhttps://source.corp.google.com/android/bionic/libc/bionic/realpath.cpp;l\u003d64;bpv\u003d0;bpt\u003d1",
      "parentUuid": "5a4047f8_6ec1a19d",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 12,
        "endChar": 45
      },
      "revId": "a0cceb7c827fa205099a1da8fae78dd90c0b4755",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a5e72ded_92daaa45",
        "filename": "microdroid/system/private/dex2oat.te",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-08-12T14:14:58Z",
      "side": 1,
      "message": "Hmm, that\u0027s odd. Why does dex2oat calls realpath on a FD? Anyway, if that\u0027s the only reason \u0027open\u0027 is needed, we could silence it using dontaudit instead of granting the permission.\n\nAs I said, I don\u0027t want to block you on this. So +2. It\u0027s up to you to fix this in this CL or in a follow-up CL.",
      "parentUuid": "bc69ba61_5c7cb04b",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 12,
        "endChar": 45
      },
      "revId": "a0cceb7c827fa205099a1da8fae78dd90c0b4755",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6bb1f3ea_5d1a764e",
        "filename": "microdroid/system/private/dex2oat.te",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2021-08-12T14:26:59Z",
      "side": 1,
      "message": "Thanks.  I\u0027ll figure it out.",
      "parentUuid": "a5e72ded_92daaa45",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 12,
        "endChar": 45
      },
      "revId": "a0cceb7c827fa205099a1da8fae78dd90c0b4755",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}