{
  "comments": [
    {
      "key": {
        "uuid": "7014c0d4_a72474c4",
        "filename": "private/logpersist.te",
        "patchSetId": 19
      },
      "lineNbr": 19,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "Can you please indent 2 here? It makes it clearer that this is a userdebug_or_eng block.",
      "range": {
        "startLine": 6,
        "startChar": 0,
        "endLine": 19,
        "endChar": 44
      },
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_67badc0b",
        "filename": "private/logpersist.te",
        "patchSetId": 19
      },
      "lineNbr": 35,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:59:38Z",
      "side": 1,
      "message": "Essentially a duplicate of a neverallow rule in domain.te:\n\n# Only recovery should be doing writes to /system\nneverallow { domain -recovery } { system_file exec_type }:dir_file_class_set\n    { create write setattr relabelfrom append unlink link rename };",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_c79648d9",
        "filename": "public/domain.te",
        "patchSetId": 19
      },
      "lineNbr": 561,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "You never actually grant logcat the ability to read symbolic links stored in /data/local/tmp. Adding an exclusion here is unneeded.",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_87edb047",
        "filename": "public/domain.te",
        "patchSetId": 19
      },
      "lineNbr": 576,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "In logcat.te, this rule is granted conditionally within a userdebug_or_eng block. If you intended to keep the userdebug_or_eng block, adding a corresponding userdebug_or_eng block here would be consistent:\n\n  userdebug_or_eng(`-logcat\u0027)\n\nHowever, please see my comment in logcat.te.",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_27eaa42e",
        "filename": "public/domain.te",
        "patchSetId": 19
      },
      "lineNbr": 588,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "In logcat.te, this rule is granted conditionally within a userdebug_or_eng block. If you intended to keep the userdebug_or_eng block, adding a corresponding userdebug_or_eng block here would be consistent:\n\n  userdebug_or_eng(`-logcat\u0027)\n\nHowever, please see my comment in logcat.te.",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_47e79863",
        "filename": "public/domain.te",
        "patchSetId": 19
      },
      "lineNbr": 601,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "In logcat.te, this rule is granted conditionally within a userdebug_or_eng block. If you intended to keep the userdebug_or_eng block, adding a corresponding userdebug_or_eng block here would be consistent:\n\n  userdebug_or_eng(`-logcat\u0027)\n\nHowever, please see my comment in logcat.te.",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_47d5589f",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 2,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "Is this needed? This service shouldn\u0027t need to be reachable from Android applications. This flag indicates that this crosses an Android app multi-user boundary.",
      "range": {
        "startLine": 2,
        "startChar": 21,
        "endLine": 2,
        "endChar": 38
      },
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b07d5855_a56ae859",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 2,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2016-11-23T16:58:55Z",
      "side": 1,
      "message": "I thought applications use logcat as an API and can popen it as needed?",
      "parentUuid": "7014c0d4_47d5589f",
      "range": {
        "startLine": 2,
        "startChar": 21,
        "endLine": 2,
        "endChar": 38
      },
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_e70eecaa",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 5,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "By convention, rules for the various domains go in their specific file. Can you remove this, and put:\n\n  shell.te:\n\n  domain_auto_trans(shell, logcat_exec, logcat)\n\n  adbd.te:\n\n  domain_auto_trans(adbd, logcat_exec, logcat)",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_2704e47a",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 6,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "Today, the \"su\" domain can do everything that the logcat domain can do, so this isn\u0027t strictly necessary. This will effectively drop to logcat privileges when the adbd root user executes su. If this is what you want, it\u0027s fine, but more error prone.",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_f2a2284a",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 6,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T02:02:40Z",
      "side": 1,
      "message": "As an example of how this might be error prone, consider the following:\n\n  adb root\n  adb shell\n  logcat -d \u003e /dev/logcat.txt\n\nIn this particular case, the adb root user (\"su\" domain) is asking logcat to dump it\u0027s output to /dev/logcat.txt. The logcat domain doesn\u0027t have permissions to write there, generating the denial:\n\navc: denied { write } for pid\u003d6869 comm\u003d\"logcat\" path\u003d\"/dev/logcat.txt\" dev\u003d\"tmpfs\" ino\u003d61215 scontext\u003du:r:logcat:s0 tcontext\u003du:object_r:device:s0 tclass\u003dfile permissive\u003d0\n\nand the file ends up empty:\n\n  marlin:/ # ls -la /dev/logcat.txt                                                                                                          \n  -rw-rw-rw- 1 root root 0 1970-05-11 14:09 /dev/logcat.txt",
      "parentUuid": "7014c0d4_2704e47a",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b07d5855_25a6d892",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 6,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2016-11-23T16:58:55Z",
      "side": 1,
      "message": "I was nervous about /dev/ because the logcat could be used as an exploit. I want to contain it. I am really on the fence to allow /dev/\u003cfile\u003e, need to keep it away from /dev/\u003cdevice\u003e or any of the /dev/\u003cconfig\u003e arenas.\n\n(parents fighting? :-) ) jeffv@ got real nervous with logcat being able to write anywhere. He had me scrub logcat writing to locations where shell can write (/data/local/tmp), I countered with a userdebug_or_eng. Did I go to far with su ... perhaps, since it is the grand master of userdebug_or_eng ;-\u003e\n\nI was expecting that when logcat is running, it is contained where it can write. Redirection (| or \u003e) and direction (logcat -f) have resulted in complications. What I am hoping for is a clear list of where logcat can write for development, and for user.",
      "parentUuid": "7014c0d4_f2a2284a",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_e7682cd5",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 11,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "Already granted by virtue of line 5 above. Can be deleted.",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_c76ba82b",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 15,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "odd... Leaking file descriptor from the shell user?",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b07d5855_257fb81a",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 15,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2016-11-23T16:58:55Z",
      "side": 1,
      "message": "logcat -b all -d | grep avc:\n\nThe pipe is denied without this line.",
      "parentUuid": "7014c0d4_c76ba82b",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_e72d8cc3",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 16,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "If you exclude this, the following sequence of commands will fail\n\n  adb shell\n  logcat -f /data/local/tmp/asdf\n\non a user build. Intentional? What\u0027s the purpose of the userdebug_or_eng block here?",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b07d5855_859de443",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 16,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2016-11-23T16:58:55Z",
      "side": 1,
      "message": "I had these open, jeff wanted me to remove them, I countered with userdebug_or_eng. Besides, any logged /data is bad m\u0027kay on \"user\" so this does follow through with logpersist.te limitations.\n\nYes, logcat -f will on purpose be broken and locked out on \"user\". I do not want logcat to be used as an exploit, and -f (especially via symbolic links) are security risks :-(. I could log a message at low priority, and then use logcat to write that content somewhere.\n\nI view all this discussion as the \"unintended side effects\" of creating a logcat domain. When I was at incept of logd, I had a specific logcat domain and we all scrubbed it because of the complications and side effects. I think I was here almost three years ago trying to defend logcat.te for some of the same reasons (except back then, none of us realized that logcat -f was broken badly)",
      "parentUuid": "7014c0d4_e72d8cc3",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_27d864da",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 21,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:48:35Z",
      "side": 1,
      "message": "When run from the unprivileged \"adb shell\" user, DAC will deny this capability, even if granted by SELinux. This suggests this functionality may not be needed. Is this capability truly used?",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b07d5855_65b700b7",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 21,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2016-11-23T16:58:55Z",
      "side": 1,
      "message": "logcat -f uses it, it drops to background cgroup and batch policy. This improves the impact logcat has on storage (there needs to be more work down there, -f is simplistic and could be evil with regards to storage).\n\nWe need to decide if -f and redirection are acceptable on \"user\" builds, but this capability needs to be available for all builds I expect.",
      "parentUuid": "7014c0d4_27d864da",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_c7a408ed",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 40,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:59:38Z",
      "side": 1,
      "message": "Essentially a duplicate of a neverallow rule in domain.te:\n\n# Only recovery should be doing writes to /system\nneverallow { domain -recovery } { system_file exec_type }:dir_file_class_set\n    { create write setattr relabelfrom append unlink link rename };",
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_27b4e418",
        "filename": "public/logcat.te",
        "patchSetId": 19
      },
      "lineNbr": 46,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:59:38Z",
      "side": 1,
      "message": "extra whitespace between backtick and -coredump_file",
      "range": {
        "startLine": 46,
        "startChar": 48,
        "endLine": 46,
        "endChar": 49
      },
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7014c0d4_a79f949e",
        "filename": "public/logd.te",
        "patchSetId": 19
      },
      "lineNbr": 50,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2016-11-23T00:59:38Z",
      "side": 1,
      "message": "extra whitespace between backtick and -coredump_file",
      "range": {
        "startLine": 50,
        "startChar": 58,
        "endLine": 50,
        "endChar": 59
      },
      "revId": "65394d1cef37078571b33c8397330d5136536ed7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}