{
  "comments": [
    {
      "key": {
        "uuid": "125ec937_0338bd7d",
        "filename": "private/installd.te",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2019-01-17T19:59:53Z",
      "side": 1,
      "message": "From an architecture perspective, it would really be better if the app ran the compiler itself, rather than relying on installd to do it. For example, that\u0027s what we do with the renderscript compiler. \n\nhttps://android.googlesource.com/platform/system/sepolicy/+/4c3d11c018724af5a7f2405ca72e3407f78a1ad4/private/untrusted_app_all.te#131\n\n(app executes /system/bin/bcc or /system/bin/ld.mc and places the files in the app\u0027s home directory, rather than installd doing it)\n\nAndroid hasn\u0027t been consistent about how we handle this, as evidenced by the different behavior of dex2oat / dexoptanalyzer (lines 6 and 9) and renderscript.\n\nCan you help me understand more about why installd should be tasked with this responsibility compared to having the app execute /system/bin/viewcompiler itself?",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 0
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0d98113_b671b055",
        "filename": "private/installd.te",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1335232
      },
      "writtenOn": "2019-01-17T21:14:55Z",
      "side": 1,
      "message": "The goal of this feature is to improve app startup time by precompiling layout resources so they can be inflated faster. Because of this, we\u0027d like to compile the layouts at app install time, so we can use the fast path right after the application starts up.\n\nWe did consider having the app launch this on-demand. Basically, when trying to inflate a layout, if the precompiled one wasn\u0027t available, we\u0027d launch viewcompiler so it\u0027d be available the next time. There are two main downsides to this: first app startup would be slower, and running the viewcompiler could put more pressure on the system when we\u0027re already trying to start an app as fast as possible.",
      "parentUuid": "125ec937_0338bd7d",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 0
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "747646e1_b93bdb7b",
        "filename": "private/installd.te",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1335232
      },
      "writtenOn": "2019-01-19T00:21:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d0d98113_b671b055",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 0
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "31c35879_8a462c0a",
        "filename": "private/viewcompiler.te",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2019-01-17T19:02:49Z",
      "side": 1,
      "message": "nit: space",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 1
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c9bbeb7d_41ee90d4",
        "filename": "private/viewcompiler.te",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1335232
      },
      "writtenOn": "2019-01-17T21:14:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "31c35879_8a462c0a",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 1
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ec3f72db_c4024ff6",
        "filename": "private/viewcompiler.te",
        "patchSetId": 4
      },
      "lineNbr": 16,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2019-01-17T19:02:49Z",
      "side": 1,
      "message": "Can we exclude priv apps, since we are moving them to execute signed code only?  This is similar to android:preferCodeIntegrity.",
      "range": {
        "startLine": 16,
        "startChar": 21,
        "endLine": 16,
        "endChar": 38
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "69d85c2d_e778a658",
        "filename": "private/viewcompiler.te",
        "patchSetId": 4
      },
      "lineNbr": 16,
      "author": {
        "id": 1335232
      },
      "writtenOn": "2019-01-17T21:14:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ec3f72db_c4024ff6",
      "range": {
        "startLine": 16,
        "startChar": 21,
        "endLine": 16,
        "endChar": 38
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "45deb517_44c257a4",
        "filename": "private/viewcompiler.te",
        "patchSetId": 4
      },
      "lineNbr": 16,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2019-01-17T21:46:39Z",
      "side": 1,
      "message": "Since we\u0027re making an explicit decision to exclude privapp_data_file, can we add a neverallow compile time assertion, to enforce that this security invariant cannot be changed.\n\n  neverallow viewcompiler privapp_data_file:file no_w_file_perms;\n\n(placed at the bottom of this file, after all the allow rules)",
      "parentUuid": "69d85c2d_e778a658",
      "range": {
        "startLine": 16,
        "startChar": 21,
        "endLine": 16,
        "endChar": 38
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aeb43266_f331842d",
        "filename": "private/viewcompiler.te",
        "patchSetId": 4
      },
      "lineNbr": 16,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2019-01-17T21:47:55Z",
      "side": 1,
      "message": "# priv-apps are moving to a world where they can only execute\n  # signed code. Make sure viewcompiler never can write to privapp\n  # directories to avoid introducing unsigned executable code\n  neverallow viewcompiler ....",
      "parentUuid": "45deb517_44c257a4",
      "range": {
        "startLine": 16,
        "startChar": 21,
        "endLine": 16,
        "endChar": 38
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "41dd7879_20eb8d3a",
        "filename": "private/viewcompiler.te",
        "patchSetId": 4
      },
      "lineNbr": 16,
      "author": {
        "id": 1335232
      },
      "writtenOn": "2019-01-17T22:41:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "aeb43266_f331842d",
      "range": {
        "startLine": 16,
        "startChar": 21,
        "endLine": 16,
        "endChar": 38
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "423ea86d_8d19a990",
        "filename": "private/viewcompiler.te",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2019-01-17T19:59:53Z",
      "side": 1,
      "message": "by convention, brackets are not used when only one element is in the list. Should be written as:\n\n  allow viewcompiler apk_data_file:file read;",
      "range": {
        "startLine": 19,
        "startChar": 19,
        "endLine": 19,
        "endChar": 20
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e4871423_f8a96ad3",
        "filename": "private/viewcompiler.te",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1335232
      },
      "writtenOn": "2019-01-17T21:14:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "423ea86d_8d19a990",
      "range": {
        "startLine": 19,
        "startChar": 19,
        "endLine": 19,
        "endChar": 20
      },
      "revId": "0cfa1ade48af3802b7e39f85a3406a0279003bb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}