{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "22b081df_13255a45",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1124543
      },
      "writtenOn": "2021-01-13T18:38:26Z",
      "side": 1,
      "message": "FYI this feature",
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2c8c46d5_bb07fca7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2021-01-13T18:47:07Z",
      "side": 1,
      "message": "What\u0027s the user consent flow, and is it once, or per bug report?",
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c7d6b647_5f2651b5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1124543
      },
      "writtenOn": "2021-01-13T18:52:42Z",
      "side": 1,
      "message": "It\u0027s ask-every-time, and for carrier apps that\u0027s mandated by CDD language. This is what a user will see: https://screenshot.googleplex.com/jexXAYzzDmxQwRX",
      "parentUuid": "2c8c46d5_bb07fca7",
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cf353d7d_a777af31",
        "filename": "public/dumpstate.te",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2021-01-13T10:26:34Z",
      "side": 1,
      "message": "I think this still does not allow signature app private files - is that right? asking mostly out of curiosity",
      "range": {
        "startLine": 44,
        "startChar": 33,
        "endLine": 44,
        "endChar": 37
      },
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "41cd2f41_a431533e",
        "filename": "public/dumpstate.te",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1124543
      },
      "writtenOn": "2021-01-13T18:21:08Z",
      "side": 1,
      "message": "That\u0027s beyond my limited knowledge of SELinux, but I can find plenty of other examples of configs only using {privapp_data_file app_data_file}.\n\nThere are a handful of configs that use {privapp_data_file app_data_file system_app_data_file}, but it seems that\u0027s less prevalent. And wouldn\u0027t Shell count as a signature app? If so, I\u0027d imagine the existing policy is working as we need, right? Since the shell does access BugreportManager and gets a non-null instance already.\n\nhttps://source.corp.google.com/search?q\u003d(priv)%3Fapp_data_file%5C%20(priv)%3Fapp_data_file%20f:te$\u0026sq\u003dpackage:%5Eandroid$",
      "parentUuid": "cf353d7d_a777af31",
      "range": {
        "startLine": 44,
        "startChar": 33,
        "endLine": 44,
        "endChar": 37
      },
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2222981b_61bac6cf",
        "filename": "public/dumpstate.te",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2021-01-13T18:29:46Z",
      "side": 1,
      "message": "Which data specifically? I thought bugreports needed to try to avoid this kind of data. Can we scope it down? (Jeff?)",
      "range": {
        "startLine": 45,
        "startChar": 36,
        "endLine": 45,
        "endChar": 49
      },
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "206d38da_bf4df428",
        "filename": "public/dumpstate.te",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1124543
      },
      "writtenOn": "2021-01-13T18:38:26Z",
      "side": 1,
      "message": "I will highlight that we\u0027re already limiting in what can be done with the file (append-only).\n\nFor some background here, BugreportManager is the ultimate API we\u0027re affecting, and we\u0027re working to make it so that some non-privapps from the Play Store can use the API when they hold the right permissions. BugreportManager accepts a ParcelFileDescriptor from the app, which (if the user consents to sharing the BR with the app) dumpstate copies the final BR file back to.\n\nWe need to change this code so that dumpstate can also write the final file for those non-privapp callers. If there\u0027s a way to do this that\u0027s more tightly scoped, I\u0027m open to suggestions - this CL is pretty much the extent of my SEPolicy knowledge :)",
      "parentUuid": "2222981b_61bac6cf",
      "range": {
        "startLine": 45,
        "startChar": 36,
        "endLine": 45,
        "endChar": 49
      },
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ebc8895b_045c9920",
        "filename": "public/dumpstate.te",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2021-01-13T19:01:08Z",
      "side": 1,
      "message": "Could we pass a specific file or group of files as open\u0027d FDs so that the app retains the rights to the files, and dumpstate doesn\u0027t have permissions to open arbitrary files (even the rule being edited here is overly)?",
      "parentUuid": "206d38da_bf4df428",
      "range": {
        "startLine": 45,
        "startChar": 36,
        "endLine": 45,
        "endChar": 49
      },
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "849c10b3_69b980c1",
        "filename": "public/dumpstate.te",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2021-01-13T19:02:18Z",
      "side": 1,
      "message": "Or I suppose, is that already the case, and this only allows those files to be changed? (I should let Jeff handle it)",
      "parentUuid": "ebc8895b_045c9920",
      "range": {
        "startLine": 45,
        "startChar": 36,
        "endLine": 45,
        "endChar": 49
      },
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2cc8cbcc_5793a6ca",
        "filename": "public/dumpstate.te",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1124543
      },
      "writtenOn": "2021-01-13T22:27:47Z",
      "side": 1,
      "message": "From the app side, the ParcelFileDescriptor has to be opened specifically with WRITE_ONLY|APPEND mode [1, 2], but I\u0027m not 100% sure that answers your question.\n\nThis is starting to exceed my knowledge of SELinux and file descriptors, but if there\u0027s a way to tighten this particular rule up (without breaking BugreportManager functionality) do let me know. Jeff?\n\n[1] http://cs/android/frameworks/base/core/java/android/os/BugreportManager.java?l\u003d146-149\u0026rcl\u003d78e646695492ebb6d7d5882bf8e674f3b8839302\n[2] http://cs/android/frameworks/base/core/tests/bugreports/src/com/android/os/bugreports/tests/BugreportManagerTest.java?l\u003d335-338\u0026rcl\u003d78e646695492ebb6d7d5882bf8e674f3b8839302",
      "parentUuid": "849c10b3_69b980c1",
      "range": {
        "startLine": 45,
        "startChar": 36,
        "endLine": 45,
        "endChar": 49
      },
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a4397055_a7f2d2ab",
        "filename": "public/dumpstate.te",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2021-01-15T19:14:49Z",
      "side": 1,
      "message": "\u003e Or I suppose, is that already the case, and this only allows those files to be changed? (I should let Jeff handle it)\n\nYes, this limits the files that dumpstate can append to just the file the app passes to it.",
      "parentUuid": "2cc8cbcc_5793a6ca",
      "range": {
        "startLine": 45,
        "startChar": 36,
        "endLine": 45,
        "endChar": 49
      },
      "revId": "d22a15d75d1945f76c30bacf04c5ddf038f7aeb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}