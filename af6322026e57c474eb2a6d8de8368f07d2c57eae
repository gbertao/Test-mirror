{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "acbeb2cb_d7ec7abb",
        "filename": "microdroid/system/private/authfs.te",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-08-04T23:04:31Z",
      "side": 1,
      "message": "Aren\u0027t these implied by the macro?",
      "range": {
        "startLine": 7,
        "startChar": 62,
        "endLine": 7,
        "endChar": 80
      },
      "revId": "af6322026e57c474eb2a6d8de8368f07d2c57eae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "456c6350_699f3ab3",
        "filename": "microdroid/system/private/authfs.te",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2021-08-04T23:14:56Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "acbeb2cb_d7ec7abb",
      "range": {
        "startLine": 7,
        "startChar": 62,
        "endLine": 7,
        "endChar": 80
      },
      "revId": "af6322026e57c474eb2a6d8de8368f07d2c57eae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ffa3a225_0d62387e",
        "filename": "microdroid/system/private/authfs_service.te",
        "patchSetId": 3
      },
      "lineNbr": 19,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-08-04T23:04:31Z",
      "side": 1,
      "message": "create_dir_perms should contain this.",
      "range": {
        "startLine": 19,
        "startChar": 61,
        "endLine": 19,
        "endChar": 73
      },
      "revId": "af6322026e57c474eb2a6d8de8368f07d2c57eae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "987fae0f_a90f3de3",
        "filename": "microdroid/system/private/authfs_service.te",
        "patchSetId": 3
      },
      "lineNbr": 19,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2021-08-04T23:14:56Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ffa3a225_0d62387e",
      "range": {
        "startLine": 19,
        "startChar": 61,
        "endLine": 19,
        "endChar": 73
      },
      "revId": "af6322026e57c474eb2a6d8de8368f07d2c57eae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "359eb538_8d365b5d",
        "filename": "microdroid/system/private/authfs_service.te",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2021-08-04T22:54:03Z",
      "side": 1,
      "message": "Joel, do you know if open(2) also requires read/write (depending on the open mode)?  This service should only open and pass the FD to the client.\n\nOr could it be getattr the read/write check?",
      "range": {
        "startLine": 23,
        "startChar": 48,
        "endLine": 23,
        "endChar": 63
      },
      "revId": "af6322026e57c474eb2a6d8de8368f07d2c57eae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a35cf015_5b66d828",
        "filename": "microdroid/system/private/authfs_service.te",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2021-08-04T22:54:03Z",
      "side": 1,
      "message": "+Steven to confirm the theory.  If it\u0027s correct, I\u0027ll file a bug to avoid the ashmem access.\n\nThe service should not require getattr.  This getattr here seems to be happened internally during ParcelableFileDesciptor serialization.  Here is a snippet of strace during PFD serialization:\n\n  160   fcntl(5, F_DUPFD_CLOEXEC, 0)      \u003d 6\n  160   getuid()                          \u003d 0\n  160   writev(4, [{iov_base\u003d\"\\0\\240\\0 \\22\\va\\2542\\2208\", iov_len\u003d11}, {iov_base\u003d\"\\6\", iov_len\u003d1}, {iov_base\u003d\"ashmem\\0\", iov_len\u003d7}, {iov_base\u003d\"memfd: ro.vndk.version not defin\"..., iov_len\u003d77}], 4) \u003d 96\n  160   fstat(6, {st_mode\u003dS_IFREG|0400, st_size\u003d307760, ...}) \u003d 0\n  160   close(5 \u003cunfinished ...\u003e\n\nIt seems to try to estimate size for ashmem. Which shouldn\u0027t be necessary for RPC.\n\nhttps://cs.android.com/android/platform/superproject/+/master:frameworks/native/libs/binder/Parcel.cpp;l\u003d122?q\u003dframeworks%2Fnative%2Flibs%2Fbinder%2FParcel.cpp",
      "range": {
        "startLine": 23,
        "startChar": 40,
        "endLine": 23,
        "endChar": 47
      },
      "revId": "af6322026e57c474eb2a6d8de8368f07d2c57eae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "07696704_759cd6ae",
        "filename": "microdroid/system/private/authfs_service.te",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1208973
      },
      "writtenOn": "2021-08-04T23:04:31Z",
      "side": 1,
      "message": "Unfortunately, no, I don\u0027t know.  I agree that it sounds like open shouldn\u0027t require read/write and that getattr might make more sense as I think open does check if it has the specified permission.  Do you know what the open mode/flags are, and can you test changing them to see what happens here?",
      "parentUuid": "359eb538_8d365b5d",
      "range": {
        "startLine": 23,
        "startChar": 48,
        "endLine": 23,
        "endChar": 63
      },
      "revId": "af6322026e57c474eb2a6d8de8368f07d2c57eae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f27087d7_4a7ea30f",
        "filename": "microdroid/system/private/authfs_service.te",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2021-08-04T23:14:56Z",
      "side": 1,
      "message": "Yes.  I wrote a test program to explicit only open.  The strace is like\n\n 160  openat(AT_FDCWD, \"/data/misc/authfs/1/5\", O_RDONLY|O_CLOEXEC) \u003d 5\n (plus the rest in the following comment)",
      "parentUuid": "07696704_759cd6ae",
      "range": {
        "startLine": 23,
        "startChar": 48,
        "endLine": 23,
        "endChar": 63
      },
      "revId": "af6322026e57c474eb2a6d8de8368f07d2c57eae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}