{
  "comments": [
    {
      "key": {
        "uuid": "c0abfa98_97224b4c",
        "filename": "public/te_macros",
        "patchSetId": 3
      },
      "lineNbr": 341,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2019-12-05T02:52:18Z",
      "side": 1,
      "message": "I\u0027m going to leave it up to nnk/jeffv, but would it make sense to require individual services to add this permission since only ones wanting to use registration callbacks/lazy callbacks need this? HIDL has the same rule on L356\n\nAlso, I\u0027m wondering, how were the registration callbacks working before? Were they working at all!? I\u0027m very confused.. It could be that they were actually unneeded in practice. Wow... okay, actually, it seems much safer to keep this, since some of this paths should be hard to hit.\n\nJeff/Nick?",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 341,
        "endChar": 49
      },
      "revId": "e46f1670b1076084c810e6b080c6ed7d1d80b22c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c5c50d37_e4b52b93",
        "filename": "public/te_macros",
        "patchSetId": 3
      },
      "lineNbr": 341,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2019-12-05T08:44:18Z",
      "side": 1,
      "message": "I would also prefer that we not broadly grant this. It\u0027s unfortunate that we already do for hwservicemanager :(.\n\nServiceManager is reachable by almost every process on Android, and certainly by every app, which makes it a compelling target for privilege escalation. However, once in ServiceManager, further options are limited because ServiceManager is very restricted in what other processes it can reach. That\u0027s no longer true with this change. Particularly concerning is the ability to reach very privileged processes like vold, installd, and zygote. Coupled with running as AID_SYSTEM which grants most permissions, this seems like a very dangerous change.\n\nI agree with Steven, we should limit this to the subset of processes that actually need it.",
      "parentUuid": "c0abfa98_97224b4c",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 341,
        "endChar": 49
      },
      "revId": "e46f1670b1076084c810e6b080c6ed7d1d80b22c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2a5157ef_5e3e2277",
        "filename": "public/te_macros",
        "patchSetId": 3
      },
      "lineNbr": 341,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2019-12-05T17:16:51Z",
      "side": 1,
      "message": "Wait, sorry, you are disagreeing with me. See the second part of my poorly-worded comment. Can you weigh this against how error prone it is to restrict this? If anyone takes over sm, the existing risk is that they will imitate other services. Making what will be oneway calls is relatively benign, since you would need an additional escalation to take advantage of it.\n\nAlso, Jon, can you answer how it is that this permission wasn\u0027t needed before?",
      "parentUuid": "c5c50d37_e4b52b93",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 341,
        "endChar": 49
      },
      "revId": "e46f1670b1076084c810e6b080c6ed7d1d80b22c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "78e15dbe_4b6bb437",
        "filename": "public/te_macros",
        "patchSetId": 3
      },
      "lineNbr": 341,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2019-12-05T18:30:23Z",
      "side": 1,
      "message": "\u003e Making what will be oneway calls is relatively benign, since you would need an additional escalation to take advantage of it.\n\nAre you saying that this isn\u0027t a problem because there would need to be a vulnerability in the service?",
      "parentUuid": "2a5157ef_5e3e2277",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 341,
        "endChar": 49
      },
      "revId": "e46f1670b1076084c810e6b080c6ed7d1d80b22c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e7064395_f08e028b",
        "filename": "public/te_macros",
        "patchSetId": 3
      },
      "lineNbr": 341,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2019-12-05T18:38:03Z",
      "side": 1,
      "message": "Actually, on second thought, it would be foolish for me to say that. Still the difference between \"completely hosed\" and \"completely hosed\" is, well, we\u0027d be completely hosed.\n\nFor why this permission wasn\u0027t needed before, I\u0027ve filed b/145748309, since we definitely should have needed this permission.\n\nMaybe we can approach this race another way. I am concerned that someone will call waitForService, and only zero zero zero point zero one percent of the time, the service will start late, and the client will fail to get the service (maybe this is the answer to b/145748309). Do we have a solution to detect when this happens?",
      "parentUuid": "78e15dbe_4b6bb437",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 341,
        "endChar": 49
      },
      "revId": "e46f1670b1076084c810e6b080c6ed7d1d80b22c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e3b6cff6_2f41faf5",
        "filename": "public/te_macros",
        "patchSetId": 3
      },
      "lineNbr": 341,
      "author": {
        "id": 1525136
      },
      "writtenOn": "2019-12-05T23:46:56Z",
      "side": 1,
      "message": "I added my findings to b/145748309. I definitely don\u0027t want to introduce vulnerabilities, so I\u0027ll look into doing this on a per-service basis as suggested. Thanks for the feedback!",
      "parentUuid": "e7064395_f08e028b",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 341,
        "endChar": 49
      },
      "revId": "e46f1670b1076084c810e6b080c6ed7d1d80b22c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8dcdea6_57fc7166",
        "filename": "public/te_macros",
        "patchSetId": 3
      },
      "lineNbr": 341,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2019-12-06T18:35:49Z",
      "side": 1,
      "message": "You\u0027re not introducing vulnerabilities, there\u0027s just a concern that you\u0027re making new (or existing) vulnerabilities easier to reach.",
      "parentUuid": "e3b6cff6_2f41faf5",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 341,
        "endChar": 49
      },
      "revId": "e46f1670b1076084c810e6b080c6ed7d1d80b22c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2a3c7cf6_e875e472",
        "filename": "public/te_macros",
        "patchSetId": 3
      },
      "lineNbr": 341,
      "author": {
        "id": 1525136
      },
      "writtenOn": "2019-12-19T23:10:43Z",
      "side": 1,
      "message": "After meeting to discuss the trade-offs and intended use cases, we decided to move forward with this change.",
      "parentUuid": "d8dcdea6_57fc7166",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 341,
        "endChar": 49
      },
      "revId": "e46f1670b1076084c810e6b080c6ed7d1d80b22c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "392ff367_c5ea1213",
        "filename": "public/te_macros",
        "patchSetId": 3
      },
      "lineNbr": 341,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2019-12-20T08:16:10Z",
      "side": 1,
      "message": "Summary of our discussion: the callback is much more efficient than polling (which is what we currently do), and the plan is to make this standard. So the broad grant is necessary and appropriate.",
      "parentUuid": "2a3c7cf6_e875e472",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 341,
        "endChar": 49
      },
      "revId": "e46f1670b1076084c810e6b080c6ed7d1d80b22c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "328f0757_201f1f4a",
        "filename": "public/te_macros",
        "patchSetId": 3
      },
      "lineNbr": 341,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2019-12-20T08:16:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "392ff367_c5ea1213",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 341,
        "endChar": 49
      },
      "revId": "e46f1670b1076084c810e6b080c6ed7d1d80b22c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}