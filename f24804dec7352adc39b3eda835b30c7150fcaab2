{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "7cf2d7b9_18df23cd",
        "filename": "public/hal_graphics_allocator.te",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2024-02-05T07:56:58Z",
      "side": 1,
      "message": "IIUC, this is no longer necessary. The appropriate apps are already granted access due to the inclusion of app_api_service.",
      "range": {
        "startLine": 6,
        "startChar": 0,
        "endLine": 9,
        "endChar": 51
      },
      "revId": "f24804dec7352adc39b3eda835b30c7150fcaab2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "89b35719_4e932765",
        "filename": "public/hal_graphics_allocator.te",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1415877
      },
      "writtenOn": "2024-02-05T08:06:50Z",
      "side": 1,
      "message": "Well, I got the following denials with Cuttlefish without this.\n```\n02-05 17:04:54.824     0     0 E SELinux : avc:  denied  { find } for pid\u003d598 uid\u003d1000 name\u003dmapper/minigbm scontext\u003du:r:surfaceflinger:s0 tcontext\u003du:object_r:hal_graphics_mapper_service:s0 tclass\u003dservice_manager permissive\u003d0\n02-05 17:04:55.523     0     0 E SELinux : avc:  denied  { find } for pid\u003d673 uid\u003d1003 name\u003dmapper/minigbm scontext\u003du:r:bootanim:s0 tcontext\u003du:object_r:hal_graphics_mapper_service:s0 tclass\u003dservice_manager permissive\u003d0\n02-05 17:05:03.683     0     0 E SELinux : avc:  denied  { find } for pid\u003d671 uid\u003d1046 name\u003dmapper/minigbm scontext\u003du:r:mediaswcodec:s0 tcontext\u003du:object_r:hal_graphics_mapper_service:s0 tclass\u003dservice_manager permissive\u003d0\n02-05 17:05:06.816     0     0 E SELinux : avc:  denied  { find } for pid\u003d744 uid\u003d1000 name\u003dmapper/minigbm scontext\u003du:r:system_server:s0 tcontext\u003du:object_r:hal_graphics_mapper_service:s0 tclass\u003dservice_manager permissive\u003d0\n```",
      "parentUuid": "7cf2d7b9_18df23cd",
      "range": {
        "startLine": 6,
        "startChar": 0,
        "endLine": 9,
        "endChar": 51
      },
      "revId": "f24804dec7352adc39b3eda835b30c7150fcaab2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "59c58c45_3da0350c",
        "filename": "public/hal_graphics_allocator.te",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2024-02-05T08:22:48Z",
      "side": 1,
      "message": "Oh interesting. You\u0027re hitting all sorts of weird corner cases here.\n\nCheck out how apps are currently granted access to hal_graphics_allocator_client:\nhttps://cs.android.com/android/platform/superproject/main/+/main:system/sepolicy/private/technical_debt.cil;l\u003d35\n\n(gotta love the name of that file).\n\nMy strong suspicion here is that you should just be removing the restriction that prevents isolated_compute_app from accessing this service. It needs to use the graphics allocator, so it should be able to find the service.\n\nAnd I guess you can remove the app_api_service addition, since this will be granted elsewhere (in technical_debt.cil). Sorry for misguiding you here.",
      "parentUuid": "89b35719_4e932765",
      "range": {
        "startLine": 6,
        "startChar": 0,
        "endLine": 9,
        "endChar": 51
      },
      "revId": "f24804dec7352adc39b3eda835b30c7150fcaab2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ac7d917_93ef787f",
        "filename": "public/hal_graphics_allocator.te",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1415877
      },
      "writtenOn": "2024-02-05T08:44:49Z",
      "side": 1,
      "message": "No worries. I really appreciate your help ;-)\n\nI\u0027m not sure I understand your guide correctly, but when I changed this to\n```\nallow hal_graphics_allocator_client hal_graphics_mapper_service:service_manager find;\n```\n.. and hal_graphics_mapper_service to\n```\ntype hal_graphics_mapper_service, service_manager_type;\n```\n\nit hits neverallow: https://cs.android.com/android/platform/superproject/main/+/main:system/sepolicy/public/domain.te;l\u003d631\n\n```\nneverallow check failed at out/soong/.intermediates/system/sepolicy/userdebug_plat_sepolicy.cil/android_common/userdebug_plat_sepolicy.cil:8782 from system/sepolicy/public/domain.te:626\n  (neverallow base_typeattr_278 base_typeattr_279 (service_manager (find)))\n    \u003croot\u003e\n    allow at out/soong/.intermediates/system/sepolicy/userdebug_plat_sepolicy.cil/android_common/userdebug_plat_sepolicy.cil:11226\n      (allow hal_graphics_allocator_client hal_graphics_mapper_service (service_manager (find)))\n```",
      "parentUuid": "59c58c45_3da0350c",
      "range": {
        "startLine": 6,
        "startChar": 0,
        "endLine": 9,
        "endChar": 51
      },
      "revId": "f24804dec7352adc39b3eda835b30c7150fcaab2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "37b72c25_4d639941",
        "filename": "public/hal_graphics_allocator.te",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2024-02-05T08:48:05Z",
      "side": 1,
      "message": "Looks like you need `hal_service_type` on the service declaration?",
      "parentUuid": "2ac7d917_93ef787f",
      "range": {
        "startLine": 6,
        "startChar": 0,
        "endLine": 9,
        "endChar": 51
      },
      "revId": "f24804dec7352adc39b3eda835b30c7150fcaab2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be17f246_b5a2d26c",
        "filename": "public/hal_graphics_allocator.te",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1415877
      },
      "writtenOn": "2024-02-05T08:55:27Z",
      "side": 1,
      "message": "Then, I get the check failure (, which caused me to add `-isolated_compute_app` before):\n```\nFAILED: out/soong/.intermediates/system/sepolicy/sepolicy_test/36845eb59e792b51b85fe94e076b9056/gen/sepolicy_test\nout/host/linux-x86/bin/sbox --sandbox-path out/soong/.temp --output-dir out/soong/.intermediates/system/sepolicy/sepolicy_test/36845eb59e792b51b85fe94e076b9056/gen --manifest out/soong/.intermediates/system/sepolicy/sepolicy_test/36845eb59e792b51b85fe94e076b9056/genrule.sbox.textproto\nThe failing command was run inside an sbox sandbox in temporary directory\nout/soong/.temp/sbox/b2da273e2ad1aa401673de1e0aeab16436ada70b\nThe failing command line can be found in\nout/soong/.temp/sbox/b2da273e2ad1aa401673de1e0aeab16436ada70b/sbox_command.0.bash\nFound prohibited permission granted for isolated like types. Please replace your allow statements that involve \"-isolated_app\" with \"-isolated_app_all\". Violations are shown as the following:\nallow isolated_compute_app hal_graphics_mapper_service:service_manager find\n\n```",
      "parentUuid": "37b72c25_4d639941",
      "range": {
        "startLine": 6,
        "startChar": 0,
        "endLine": 9,
        "endChar": 51
      },
      "revId": "f24804dec7352adc39b3eda835b30c7150fcaab2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ff2d76cd_a46ad051",
        "filename": "public/hal_graphics_allocator.te",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1415877
      },
      "writtenOn": "2024-02-05T09:18:10Z",
      "side": 1,
      "message": "Added a new allow in sepolicy_tests.",
      "parentUuid": "be17f246_b5a2d26c",
      "range": {
        "startLine": 6,
        "startChar": 0,
        "endLine": 9,
        "endChar": 51
      },
      "revId": "f24804dec7352adc39b3eda835b30c7150fcaab2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}