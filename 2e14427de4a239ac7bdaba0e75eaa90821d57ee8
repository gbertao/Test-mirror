{
  "comments": [
    {
      "key": {
        "uuid": "1fd01030_e0f9970c",
        "filename": "private/hal_drm_default.te",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1018773
      },
      "writtenOn": "2017-02-06T19:13:53Z",
      "side": 1,
      "message": "Why is this needed? If I understand the situation correctly, DRM HAL in the past always ran inside mediadrmserver domain. I don\u0027t see any grants there for mediacodec:fd. Did the DRM HAL by any chance run also in mediacodec? If so, binder_call(hal_drm, mediacodec) is would be more appropriate here and mediacodec\u0027s rules would need to be adjusted accordingly as well, so that the DRM HAL can be used from there even when it runs out of process.",
      "revId": "2e14427de4a239ac7bdaba0e75eaa90821d57ee8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6b9b580e_6fc4eef5",
        "filename": "private/hal_drm_default.te",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1005920
      },
      "writtenOn": "2017-02-06T21:47:34Z",
      "side": 1,
      "message": "That\u0027s right, before DRM HAL was running in passthrough mode in mediadrmserver process.\n\nDRM HAL did not ever run in mediacodec and is not supposed to.\n\nCould it have something to do with mediacodec and mediadrmserver being mlstrustedobject, but drm_hal is not?",
      "parentUuid": "1fd01030_e0f9970c",
      "revId": "2e14427de4a239ac7bdaba0e75eaa90821d57ee8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "233f318c_5a523cac",
        "filename": "private/hal_drm_default.te",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1018773
      },
      "writtenOn": "2017-02-06T22:36:23Z",
      "side": 1,
      "message": "It might have to do with MLS. What are the exact denials you\u0027re seeing which is being fixed by these two allow rules?",
      "parentUuid": "6b9b580e_6fc4eef5",
      "revId": "2e14427de4a239ac7bdaba0e75eaa90821d57ee8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ac54f260_02d6b4ca",
        "filename": "private/hal_drm_default.te",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1005920
      },
      "writtenOn": "2017-02-07T18:56:57Z",
      "side": 1,
      "message": "02-07 09:47:56.569  4665  4665 I Binder:4664_1: type\u003d1400 audit(0.0:566): avc: denied { use } for path\u003d\"anon_inode:dmabuf\" dev\u003d\"anon_inodefs\" ino\u003d12662 scontext\u003du:r:hal_drm_default:s0 tcontext\u003du:r:mediacodec:s0 tclass\u003dfd permissive\u003d1\n\n02-07 09:47:56.406  4665  4665 I Binder:4664_1: type\u003d1400 audit(0.0:565): avc: denied { use } for path\u003d\"/dev/ashmem\" dev\u003d\"tmpfs\" ino\u003d15701 scontext\u003du:r:hal_drm_default:s0 tcontext\u003du:r:untrusted_app:s0:c512,c768 tclass\u003dfd permissive\u003d1",
      "parentUuid": "233f318c_5a523cac",
      "revId": "2e14427de4a239ac7bdaba0e75eaa90821d57ee8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "beb46b08_c0a1eb73",
        "filename": "private/hal_drm_default.te",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2017-02-08T05:07:25Z",
      "side": 1,
      "message": "this was previously granted to mediadrmserver by:\nbinder_call(mediadrmserver, binderservicedomain)",
      "parentUuid": "ac54f260_02d6b4ca",
      "revId": "2e14427de4a239ac7bdaba0e75eaa90821d57ee8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e1654d3a_a4f68bca",
        "filename": "private/hal_drm_default.te",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1018773
      },
      "writtenOn": "2017-02-06T19:13:53Z",
      "side": 1,
      "message": "Why is this needed? Did DRM HAL run in untrusted_app prior to recent changes?",
      "revId": "2e14427de4a239ac7bdaba0e75eaa90821d57ee8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "843e5888_fbede129",
        "filename": "private/hal_drm_default.te",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1005920
      },
      "writtenOn": "2017-02-06T21:47:34Z",
      "side": 1,
      "message": "same as above?",
      "parentUuid": "e1654d3a_a4f68bca",
      "revId": "2e14427de4a239ac7bdaba0e75eaa90821d57ee8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0e6dd98c_932732a4",
        "filename": "private/hal_drm_default.te",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1018773
      },
      "writtenOn": "2017-02-06T22:36:23Z",
      "side": 1,
      "message": "Perhaps. I see that mediadrmserver was granted binder_call(appdomain) which means binder_call(untrusted_app) (because untrusted_app belongs into the appdomain set) which means allow mediadrmserver untrusted_app:fd use; and a couple of more rules. However, it doesn\u0027t automatically necessarily mean that DRM HAL needs to IPC over Binder into untrusted app. Do you know why DRM HAL is attempting to IPC into untrusted_app? I mean, it might be an IPC callback, but you said that only mediadrmserver initiates calls into DRM HAL...",
      "parentUuid": "843e5888_fbede129",
      "revId": "2e14427de4a239ac7bdaba0e75eaa90821d57ee8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e24300d3_aef7e25b",
        "filename": "private/hal_drm_default.te",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1005920
      },
      "writtenOn": "2017-02-07T18:56:57Z",
      "side": 1,
      "message": "DRM HAL IPCs to untrusted_app when it delivers DRM-related events",
      "parentUuid": "0e6dd98c_932732a4",
      "revId": "2e14427de4a239ac7bdaba0e75eaa90821d57ee8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5a56f3a0_3ebc4d82",
        "filename": "private/hal_drm_default.te",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2017-02-08T05:07:25Z",
      "side": 1,
      "message": "also previously granted by:\nbinder_call(mediadrmserver, binderservicedomain)\n\nWe should probably make this:\nallow hal_drm_default { appdomain -isolated_app }:fd use;\n\nBecause other app types likely require access.",
      "parentUuid": "e24300d3_aef7e25b",
      "revId": "2e14427de4a239ac7bdaba0e75eaa90821d57ee8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}