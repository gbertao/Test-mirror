{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b18ca710_de7d18ab",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1956258
      },
      "writtenOn": "2023-09-20T18:11:56Z",
      "side": 1,
      "message": "To trigger update from settings app, calling update engine : https://android-review.git.corp.google.com/c/platform/packages/apps/Settings/+/2756951/1/src/com/android/settings/development/Enable16kPagesPreferenceController.java#196 \n\nThese permissions will be needed to make the binder call",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a2b0460f_d67d613e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-09-22T00:25:37Z",
      "side": 1,
      "message": "Hey, a few things:\n- can you help me understand how the settings app normally applies OTAs? If it doesn\u0027t talk directly to OTA engine, then how?\n- adding update_engine OWNER as FYI. Yifan, WDYT of this?\n- It\u0027s really unfortunate that settings app is marked as system_app, and it\u0027s not in its own domain. I\u0027m sure security people have thought about splitting this up before, but I\u0027m not sure how hard it would be.\n- noting, some devices set this permission in device-specific sepolicy",
      "parentUuid": "b18ca710_de7d18ab",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b5f0143_266273a6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1710792
      },
      "writtenOn": "2023-09-22T02:19:44Z",
      "side": 1,
      "message": "update_engine owner here. Settings app normally applies OTA by talking to update_engine directly, same way we are doing it for 16K boot options. But that permission is managed here https://cs.android.com/android/platform/superproject/main/+/main:system/sepolicy/private/gmscore_app.te;l\u003d18?q\u003dsystem%2Fsepolicy%2Fprivate%2Fgmscore_app.te\n\n\n\u003e noting, some devices set this permission in device-specific sepolicy\n\n\nSince we are offering this functionality from platform side I think it make sense to set this permission on platform side. We should provide OEMs a \"batteries included\" solution.",
      "parentUuid": "a2b0460f_d67d613e",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b4a5602_7f2ae8e0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-09-22T23:06:04Z",
      "side": 1,
      "message": "Jeff - I\u0027m curious if you know history of effort to split settings app from system_app. I see that Google settings app is gmscore_app (which shares this codebase). That may be why it\u0027s not split out before, but policy allowing gmscore_app to talk to update_engine seems just as general as this (system_app talking to update_engine).\n\nWDYT about splitting settings app from gmscore_app and system_app and having a specific domain for it or similar?a",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4c3bf8cc_239747db",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2023-09-26T19:38:20Z",
      "side": 1,
      "message": "\u003e update_engine owner here. Settings app normally applies OTA by talking to update_engine directly, same way we are doing it for 16K boot options. But that permission is managed here https://cs.android.com/android/platform/superproject/main/+/main:system/sepolicy/private/gmscore_app.te;l\u003d18?q\u003dsystem%2Fsepolicy%2Fprivate%2Fgmscore_app.te\n\n\nI don\u0027t understand this part. How does Settings app \"normally\" do this if it doesn\u0027t currently have the right permissions?",
      "parentUuid": "0b5f0143_266273a6",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a78d48f3_5a8e870f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2023-09-26T19:38:20Z",
      "side": 1,
      "message": "Seems generally OK. Update_engine should be independently verifying the signature of the update, and the verified boot will also check that the update chains back to the root of trust.\n\nOne minor sadness is that a number of OEMs run a lot of stuff in system_app, and it would be nice keep the attack surface to update_engine more limited, but I\u0027m not sure that that should be your problem since Settings should be in system_app, and I agree that this seems like a good thing to put in developer settings.",
      "parentUuid": "1b4a5602_7f2ae8e0",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bfdb777d_21a0254e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-09-26T21:27:36Z",
      "side": 1,
      "message": "ack - moving to other thread, will file bug based on result.",
      "parentUuid": "a78d48f3_5a8e870f",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "da0017bf_5a071aeb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-09-26T21:27:36Z",
      "side": 1,
      "message": "Hmmm, this seems not to be the case. gmscore_app was introduced at API level 30, but it is not applied to settings app. Here is the result from a production Pixel 6:\n\n```\noriole:/ $ ps -AZ | grep -i setting\nu:r:system_app:s0              u10_system    6562  1146   14797644  95368 0                   0 S com.android.settings\n```\n\nThis is because gmscore_app (split off as part of b/142672293) is applied to `com.google.android.gms*` but we have com.google.android.SettingsGoogle. SettingsGoogle is still marked as system_app.\n\nSee here and auditallows in existing policy about system_app and update engine:\nhttps://cs.android.com/android/platform/superproject/main/+/main:system/sepolicy/public/update_engine.te;l\u003d38;drc\u003d448bd57181cf80ccf069b5e66816da61c5778215\n\nWhat must be happening is GoogleSettings delegates to GMSCore code to do the update. I\u0027ll move this chat to an email.",
      "parentUuid": "4c3bf8cc_239747db",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cc2de508_42110bf7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-09-26T21:33:32Z",
      "side": 1,
      "message": "email sent - also b/264266705 is bug to split up system_app. Will see if we can split settings this year, but hoping to do independently from this project.",
      "parentUuid": "da0017bf_5a071aeb",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "22306276_6f4ba275",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-09-30T01:47:31Z",
      "side": 1,
      "message": "moved to email thread",
      "parentUuid": "cc2de508_42110bf7",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bb824ca4_30038fe9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-09-30T01:47:47Z",
      "side": 1,
      "message": "\"Sepolicy changes for 16KB Developer option\"",
      "parentUuid": "22306276_6f4ba275",
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e168d992_9dbc1a19",
        "filename": "private/system_app.te",
        "patchSetId": 1
      },
      "lineNbr": 85,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2023-10-02T11:33:44Z",
      "side": 1,
      "message": "can the comment describe why this is actually needed? I know you\u0027re just copying precedent on the unhelpful comments above, but the existing comment just tells us what we (mostly) already know from the allow rule itself.\n\n\"Allow settings to call into update-engine in order to blah blah blah for 16k pages...\"",
      "range": {
        "startLine": 85,
        "startChar": 0,
        "endLine": 85,
        "endChar": 66
      },
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0ae1192f_82262f3c",
        "filename": "private/system_app.te",
        "patchSetId": 1
      },
      "lineNbr": 85,
      "author": {
        "id": 1956258
      },
      "writtenOn": "2023-10-03T18:13:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e168d992_9dbc1a19",
      "range": {
        "startLine": 85,
        "startChar": 0,
        "endLine": 85,
        "endChar": 66
      },
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6434e955_d4b8b866",
        "filename": "private/update_engine.te",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2023-10-02T11:33:44Z",
      "side": 1,
      "message": "Similarly, Mention not just what, but why.\n\nShould there be a TODO for both of these rules to be removed in the future when all devices are default using 16k pages?",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 25,
        "endChar": 67
      },
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d33c0871_9df6807b",
        "filename": "private/update_engine.te",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-10-02T16:36:52Z",
      "side": 1,
      "message": "We\u0027ll likely use it for dogfooding kernels in the future. It\u0027s a nice mechanism.",
      "parentUuid": "6434e955_d4b8b866",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 25,
        "endChar": 67
      },
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d0889908_8ae461e5",
        "filename": "private/update_engine.te",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2023-10-02T17:00:51Z",
      "side": 1,
      "message": "Update the comment!\n\nShould this go into a \"userdebug_or_eng()\" statement? Should it be allowed in production builds?",
      "parentUuid": "d33c0871_9df6807b",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 25,
        "endChar": 67
      },
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7513b607_0317b9c8",
        "filename": "private/update_engine.te",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-10-02T23:01:48Z",
      "side": 1,
      "message": "It\u0027s intended for production builds. See also b/302761914",
      "parentUuid": "d0889908_8ae461e5",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 25,
        "endChar": 67
      },
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7c757f91_b714e02d",
        "filename": "private/update_engine.te",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1956258
      },
      "writtenOn": "2023-10-03T18:13:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7513b607_0317b9c8",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 25,
        "endChar": 67
      },
      "revId": "89aca3ff43193288d0aaa518c4d44274f0188bd3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}